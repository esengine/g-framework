window.gs.physics={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o])};return function(i,o){function n(){this.constructor=i}t(i,o),i.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();var gs,__values=this&&this.__values||function(t){var i="function"==typeof Symbol&&t[Symbol.iterator],o=0;return i?i.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}},__read=this&&this.__read||function(t,i){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,e,r=o.call(t),s=[];try{for(;(void 0===i||i-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){e={error:t}}finally{try{n&&!n.done&&(o=r.return)&&o.call(r)}finally{if(e)throw e.error}}return s},__spread=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(__read(arguments[i]));return t};!function(t){!function(i){var o=function(t){function o(i,o,n,e){var r=t.call(this,i)||this;return r.entity1=o,r.entity2=n,r.velocities=e,r}return __extends(o,t),o.prototype.reset=function(){t.prototype.reset.call(this),this.entity1=null,this.entity2=null,this.velocities={v1:new i.Vector2(0,0),v2:new i.Vector2(0,0)}},o.prototype.getEntity1=function(){return this.entity1},o.prototype.getEntity2=function(){return this.entity2},o.prototype.getVelocities=function(){return this.velocities},o}(t.Event);i.CollisionEvent=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(){function o(){t.GlobalEventEmitter.on("collision",this.handleCollision.bind(this))}return o.prototype.handleCollision=function(t){var o=t.data,n=o.entity1,e=o.entity2,r=o.velocities;n.getComponent(i.RigidBody).velocity=r.v1,e.getComponent(i.RigidBody).velocity=r.v2},o}();i.CollisionHandlerSystem=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(o){function n(n){var e=o.call(this,n,0,t.Matcher.empty().all(i.RigidBody,i.Collider))||this;return e.quadTree=new i.QuadTree(0,{position:new i.Vector2(0,0),width:new i.FixedPoint(1e3),height:new i.FixedPoint(1e3)}),e}return __extends(n,o),n.prototype.update=function(o){var n,e,r,s,a,l;try{for(var h=__values(o),u=h.next();!u.done;u=h.next()){var d=(y=u.value).getComponent(i.Collider);d&&(this.quadTree.insert(d.getBounds()),d.isColliding=!1)}}catch(t){n={error:t}}finally{try{u&&!u.done&&(e=h.return)&&e.call(h)}finally{if(n)throw n.error}}try{for(var c=__values(o),p=c.next();!p.done;p=c.next()){var y,f=(y=p.value).getComponent(i.Collider);if(f){var v=f.getBounds(),w=new Set;this.quadTree.retrieve(w,v);try{for(var g=__values(Array.from(w)),x=g.next();!x.done;x=g.next()){var F=x.value;if(F.entity.getId()!==y.getId()){var m=F.entity.getComponent(i.Collider),P=m.getBounds();if(this.isColliding(v,P)){f.isColliding=!0,m.isColliding=!0;var V=this.calculateVelocityAfterCollision(y.getComponent(i.RigidBody),F.entity.getComponent(i.RigidBody));y.getComponent(i.RigidBody).velocity=V.v1,F.entity.getComponent(i.RigidBody).velocity=V.v2;var _=new i.CollisionEvent("collision",y,F.entity,V);t.GlobalEventEmitter.emitEvent(_)}}}}catch(t){a={error:t}}finally{try{x&&!x.done&&(l=g.return)&&l.call(g)}finally{if(a)throw a.error}}}}}catch(t){r={error:t}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(r)throw r.error}}this.quadTree.clear()},n.prototype.calculateVelocityAfterCollision=function(t,o){var n=i.FixedPoint.add(t.mass,o.mass),e=i.FixedPoint.sub(t.mass,o.mass),r=i.FixedPoint.sub(o.mass,t.mass),s=i.FixedPoint.mul(t.mass,2),a=i.FixedPoint.mul(o.mass,2);return{v1:t.velocity.multiplyScalar(e.toFloat()).divideScalar(n.toFloat()).add(o.velocity.multiplyScalar(a.toFloat()).divideScalar(n.toFloat())),v2:t.velocity.multiplyScalar(s.toFloat()).divideScalar(n.toFloat()).subtract(o.velocity.multiplyScalar(r.toFloat()).divideScalar(n.toFloat()))}},n.prototype.isColliding=function(t,o){var n=t.position,e=t.width,r=t.height,s=o.position,a=o.width,l=o.height;return!(s.x.gt(i.FixedPoint.add(n.x,e))||i.FixedPoint.add(s.x,a).lt(n.x)||s.y.gt(i.FixedPoint.add(n.y,r))||i.FixedPoint.add(s.y,l).lt(n.y))},n}(t.System);i.CollisionResponseSystem=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=1e3),this.rawValue=Math.round(t*i),this.precision=i}return t.prototype.add=function(i){return this.rawValue+=i instanceof t?i.rawValue:Math.round(i*this.precision),this},t.prototype.sub=function(i){return this.rawValue-=i instanceof t?i.rawValue:Math.round(i*this.precision),this},t.prototype.mul=function(i){return this.rawValue=i instanceof t?Math.round(this.rawValue*i.rawValue/i.precision):Math.round(this.rawValue*i),this},t.prototype.div=function(i){return this.rawValue=i instanceof t?Math.round(this.rawValue/i.rawValue*this.precision):Math.round(this.rawValue/i),this},t.prototype.lt=function(i){return i instanceof t?this.rawValue<i.rawValue:this.rawValue<Math.round(i*this.precision)},t.prototype.gt=function(i){return i instanceof t?this.rawValue>i.rawValue:this.rawValue>Math.round(i*this.precision)},t.prototype.gte=function(i){return i instanceof t?this.rawValue>=i.rawValue:this.rawValue>=Math.round(i*this.precision)},t.prototype.lte=function(i){return i instanceof t?this.rawValue<=i.rawValue:this.rawValue<=Math.round(i*this.precision)},t.prototype.neg=function(){var i=new t;return i.rawValue=-this.rawValue,i},t.prototype.toFloat=function(){return this.rawValue/this.precision},t.add=function(i,o){var n=new t;return n.rawValue=o instanceof t?i.rawValue+o.rawValue:i.rawValue+Math.round(o*i.precision),n},t.sub=function(i,o){var n=new t;return n.rawValue=o instanceof t?i.rawValue-o.rawValue:i.rawValue-Math.round(o*i.precision),n},t.mul=function(i,o){var n=new t;return n.rawValue=o instanceof t?Math.round(i.rawValue*o.rawValue/o.precision):Math.round(i.rawValue*o),n},t.div=function(i,o){var n=new t;return n.rawValue=o instanceof t?Math.round(i.rawValue/o.rawValue*i.precision):Math.round(i.rawValue/o),n},t.max=function(t,i){return t.gt(i)?t:i},t.min=function(t,i){return t.lt(i)?t:i},t}();t.FixedPoint=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(t,i){this.level=t,this.bounds=i,this.objects=[],this.nodes=[]}return i.prototype.split=function(){var o=t.FixedPoint.div(this.bounds.width,2),n=t.FixedPoint.div(this.bounds.height,2),e=this.bounds.position.x,r=this.bounds.position.y;this.nodes[0]=new i(this.level+1,{position:new t.Vector2(e.toFloat(),r.toFloat()),width:o,height:n}),this.nodes[1]=new i(this.level+1,{position:new t.Vector2(t.FixedPoint.add(e,o).toFloat(),r.toFloat()),width:o,height:n}),this.nodes[2]=new i(this.level+1,{position:new t.Vector2(e.toFloat(),t.FixedPoint.add(r,n).toFloat()),width:o,height:n}),this.nodes[3]=new i(this.level+1,{position:new t.Vector2(t.FixedPoint.add(e,o).toFloat(),t.FixedPoint.add(r,n).toFloat()),width:o,height:n})},i.prototype.insert=function(t){if(null!=this.nodes[0]&&-1!=(o=this.getIndex(t)))return void this.nodes[o].insert(t);if(this.objects.push(t),this.objects.length>10&&this.level<5){null==this.nodes[0]&&this.split();for(var i=0;i<this.objects.length;){var o;-1!=(o=this.getIndex(this.objects[i]))?this.nodes[o].insert(this.objects.splice(i,1)[0]):i++}}},i.prototype.getIndex=function(i){var o=-1,n=t.FixedPoint.add(this.bounds.position.x,t.FixedPoint.div(this.bounds.width,2)),e=t.FixedPoint.add(this.bounds.position.y,t.FixedPoint.div(this.bounds.height,2)),r=i.position.y.lt(e)&&t.FixedPoint.add(i.position.y,i.height).lt(e),s=i.position.y.gt(e);return i.position.x.lt(n)&&t.FixedPoint.add(i.position.x,i.width).lt(n)?r?o=1:s&&(o=2):i.position.x.gt(n)&&(r?o=0:s&&(o=3)),o},i.prototype.retrieve=function(t,i){var o,n,e=this.getIndex(i);-1!=e&&null!=this.nodes[0]&&this.nodes[e].retrieve(t,i);try{for(var r=__values(this.objects),s=r.next();!s.done;s=r.next()){var a=s.value;t.add(a)}}catch(t){o={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return t},i.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)null!=this.nodes[t]&&(this.nodes[t].clear(),this.nodes[t]=null)},i}();t.QuadTree=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.position=new i.Vector2,o.velocity=new i.Vector2,o.mass=new i.FixedPoint,o.size=new i.Vector2,o}return __extends(o,t),o}(t.Component);i.RigidBody=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.width=new t.FixedPoint(i),this.height=new t.FixedPoint(o)}return i.prototype.add=function(t){return new i(this.width.toFloat()+t.width.toFloat(),this.height.toFloat()+t.height.toFloat())},i.prototype.subtract=function(t){return new i(this.width.toFloat()-t.width.toFloat(),this.height.toFloat()-t.height.toFloat())},i.prototype.multiply=function(t){return new i(this.width.toFloat()*t,this.height.toFloat()*t)},i.prototype.divide=function(t){return new i(this.width.toFloat()/t,this.height.toFloat()/t)},i}();t.Size=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t){this.cellSize=t,this.hashTable=new Map}return t.prototype.hash=function(t,i){var o=Math.floor(t/this.cellSize);return 1e6*Math.floor(i/this.cellSize)+o},t.prototype.insert=function(t){for(var i=Math.floor(t.position.x.toFloat()/this.cellSize),o=Math.floor(t.position.y.toFloat()/this.cellSize),n=Math.floor((t.position.x.toFloat()+t.width.toFloat())/this.cellSize),e=Math.floor((t.position.y.toFloat()+t.height.toFloat())/this.cellSize),r=i;r<=n;r++)for(var s=o;s<=e;s++){var a=this.hash(r,s),l=this.hashTable.get(a);void 0===l&&(l=[],this.hashTable.set(a,l)),l.push(t)}},t.prototype.retrieve=function(t){for(var i=Math.floor(t.position.x.toFloat()/this.cellSize),o=Math.floor(t.position.y.toFloat()/this.cellSize),n=Math.floor((t.position.x.toFloat()+t.width.toFloat())/this.cellSize),e=Math.floor((t.position.y.toFloat()+t.height.toFloat())/this.cellSize),r=[],s=i;s<=n;s++)for(var a=o;a<=e;a++){var l=this.hash(s,a),h=this.hashTable.get(l);void 0!==h&&r.push.apply(r,__spread(h))}return r},t.prototype.clear=function(){this.hashTable.clear()},t}();t.SpatialHash=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.onInitialize=function(t,o){void 0===t&&(t=0),void 0===o&&(o=0),this.position=new i.Vector2(t,o)},o}(t.Component);i.Transform=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.x=i instanceof t.FixedPoint?i:new t.FixedPoint(i),this.y=o instanceof t.FixedPoint?o:new t.FixedPoint(o)}return i.prototype.add=function(t){return new i(this.x.toFloat()+t.x.toFloat(),this.y.toFloat()+t.y.toFloat())},i.prototype.subtract=function(t){return new i(this.x.toFloat()-t.x.toFloat(),this.y.toFloat()-t.y.toFloat())},i.prototype.multiply=function(t){return new i(this.x.toFloat()*t,this.y.toFloat()*t)},i.prototype.divide=function(t){return new i(this.x.toFloat()/t,this.y.toFloat()/t)},i.prototype.multiplyScalar=function(t){return new i(this.x.toFloat()*t,this.y.toFloat()*t)},i.prototype.divideScalar=function(t){return new i(this.x.toFloat()/t,this.y.toFloat()/t)},i.prototype.length=function(){return new t.FixedPoint(Math.sqrt(this.x.toFloat()*this.x.toFloat()+this.y.toFloat()*this.y.toFloat()))},i.prototype.lengthSquared=function(){return new t.FixedPoint(this.x.toFloat()*this.x.toFloat()+this.y.toFloat()*this.y.toFloat())},i.prototype.normalize=function(){var t=this.length();return new i(this.x.div(t),this.y.div(t))},i.prototype.dot=function(i){return new t.FixedPoint(this.x.toFloat()*i.x.toFloat()+this.y.toFloat()*i.y.toFloat())},i.prototype.cross=function(i){return new t.FixedPoint(this.x.toFloat()*i.y.toFloat()-this.y.toFloat()*i.x.toFloat())},i.prototype.distanceTo=function(i){var o=this.x.sub(i.x),n=this.y.sub(i.y);return new t.FixedPoint(Math.sqrt(o.toFloat()*o.toFloat()+n.toFloat()*n.toFloat()))},i}();t.Vector2=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o,n){void 0===i&&(i=new t.FixedPoint(0,-9.81)),void 0===o&&(o=new t.FixedPoint(1,60)),void 0===n&&(n=new t.Size(1e3,1e3)),this.name="PhysicsPlugin",this.gravity=i,this.timeStep=o,this.bodies=[],this.size=n}return i.prototype.onInit=function(i){i.systemManager.registerSystem(new t.CollisionResponseSystem(i.entityManager))},i.prototype.onUpdate=function(t){this.step()},i.prototype.addBody=function(t){this.bodies.push(t)},i.prototype.updateSize=function(){var i,o;try{for(var n=__values(this.bodies),e=n.next();!e.done;e=n.next()){var r=e.value;this.size.width=t.FixedPoint.max(this.size.width,t.FixedPoint.add(r.position.x,r.size.x)),this.size.height=t.FixedPoint.max(this.size.height,t.FixedPoint.add(r.position.y,r.size.y))}}catch(t){i={error:t}}finally{try{e&&!e.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}},i.prototype.handleBorderCollision=function(i){(i.position.x.lt(0)||t.FixedPoint.add(i.position.x,i.size.x).gt(this.size.width))&&(i.velocity.x=i.velocity.x.neg()),(i.position.y.lt(0)||t.FixedPoint.add(i.position.y,i.size.y).gt(this.size.height))&&(i.velocity.y=i.velocity.y.neg())},i.prototype.step=function(){var i,o;try{for(var n=__values(this.bodies),e=n.next();!e.done;e=n.next()){var r=e.value;r.velocity.y=t.FixedPoint.add(r.velocity.y,t.FixedPoint.mul(this.gravity,this.timeStep)),r.position.x=t.FixedPoint.add(r.position.x,t.FixedPoint.mul(r.velocity.x,this.timeStep)),r.position.y=t.FixedPoint.add(r.position.y,t.FixedPoint.mul(r.velocity.y,this.timeStep)),this.handleBorderCollision(r)}}catch(t){i={error:t}}finally{try{e&&!e.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}this.updateSize()},i}();t.World=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.getBounds=function(){return{position:new i.Vector2,width:new i.FixedPoint,height:new i.FixedPoint,entity:this.entity}},o}(t.Component);i.Collider=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(i){function o(){var o=null!==i&&i.apply(this,arguments)||this;return o.dependencies=[t.Transform],o}return __extends(o,i),o.prototype.onInitialize=function(i){this.size=i,this.transform=this.entity.getComponent(t.Transform)},o.prototype.getBounds=function(){return{position:this.transform.position,width:this.size.width,height:this.size.height,entity:this.entity}},o}(t.Collider);t.BoxCollider=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(){}return Object.defineProperty(t.prototype,"width",{get:function(){return this.radius.mul(2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.radius.mul(2)},enumerable:!0,configurable:!0}),t.prototype.area=function(){return this.radius.mul(this.radius).mul(Math.PI)},t.prototype.circumference=function(){return this.radius.mul(2).mul(Math.PI)},t.prototype.containsPoint=function(t){return this.position.distanceTo(t).lte(this.radius)},t.prototype.intersects=function(t){return this.position.distanceTo(t.position).lte(this.radius.add(t.radius))},t}();t.Circle=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(){}return t.prototype.area=function(){return this.width.mul(this.height)},t.prototype.containsPoint=function(t){return t.x.gte(this.position.x)&&t.x.lte(this.position.x.add(this.width))&&t.y.gte(this.position.y)&&t.y.lte(this.position.y.add(this.height))},t.prototype.intersects=function(t){return!(t.position.x.add(t.width).lt(this.position.x)||t.position.y.add(t.height).lt(this.position.y)||t.position.x.gt(this.position.x.add(this.width))||t.position.y.gt(this.position.y.add(this.height)))},t}();t.Rectangle=i}(t.physics||(t.physics={}))}(gs||(gs={}));