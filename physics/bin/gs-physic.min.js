window.gs.physics={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])};return function(o,i){function n(){this.constructor=o}t(o,i),o.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();var gs,__values=this&&this.__values||function(t){var o="function"==typeof Symbol&&t[Symbol.iterator],i=0;return o?o.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}},__read=this&&this.__read||function(t,o){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,e,r=i.call(t),s=[];try{for(;(void 0===o||o-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return s},__spread=this&&this.__spread||function(){for(var t=[],o=0;o<arguments.length;o++)t=t.concat(__read(arguments[o]));return t};!function(t){!function(o){var i=function(t){function i(o,i,n,e){var r=t.call(this,o)||this;return r.entity1=i,r.entity2=n,r.velocities=e,r}return __extends(i,t),i.prototype.reset=function(){t.prototype.reset.call(this),this.entity1=null,this.entity2=null,this.velocities={v1:new o.Vector2(0,0),v2:new o.Vector2(0,0)}},i.prototype.getEntity1=function(){return this.entity1},i.prototype.getEntity2=function(){return this.entity2},i.prototype.getVelocities=function(){return this.velocities},i}(t.Event);o.CollisionEvent=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(){function i(){t.GlobalEventEmitter.on("collision",this.handleCollision.bind(this))}return i.prototype.handleCollision=function(t){var i=t.data,n=i.entity1,e=i.entity2,r=i.velocities;n.getComponent(o.RigidBody).velocity=r.v1,e.getComponent(o.RigidBody).velocity=r.v2},i}();o.CollisionHandlerSystem=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(i){function n(n,e){void 0===e&&(e=100);var r=i.call(this,n,0,t.Matcher.empty().all(o.RigidBody,o.Collider))||this;return r.processed=new Map,r.collisionPairs=[],r.spatialHash=new o.SpatialHash(e),r}return __extends(n,i),n.prototype.update=function(t){var i,n,e,r,s=this.spatialHash,a=this.processed,l=this.collisionPairs;s.clear(),a.clear(),l.length=0;var u=function(t){var i=t.getComponent(o.Collider);if(!i)return"continue";var n=i.getBounds();s.insert(n),i.isColliding=!1;var e=t.getId(),r=a.get(e);r||(r=new Set,a.set(e,r)),s.retrieve(n,function(o){var i=o.entity.getId();e===i||r.has(i)||(l.push([t,o.entity]),r.add(i))})};try{for(var h=__values(t),c=h.next();!c.done;c=h.next()){u(f=c.value)}}catch(t){i={error:t}}finally{try{c&&!c.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}try{for(var p=__values(l),y=p.next();!y.done;y=p.next()){var d=__read(y.value,2),f=d[0],w=d[1],v=f.getComponent(o.Collider),g=w.getComponent(o.Collider),x=v.getBounds(),F=g.getBounds();this.isColliding(x,F)&&(v.isColliding=!0,g.isColliding=!0)}}catch(t){e={error:t}}finally{try{y&&!y.done&&(r=p.return)&&r.call(p)}finally{if(e)throw e.error}}},n.prototype.isColliding=function(t,i){var n=t.position,e=t.width,r=t.height,s=i.position,a=i.width,l=i.height;return!(s.x.gt(o.FixedPoint.add(n.x,e))||o.FixedPoint.add(s.x,a).lt(n.x)||s.y.gt(o.FixedPoint.add(n.y,r))||o.FixedPoint.add(s.y,l).lt(n.y))},n}(t.System);o.CollisionResponseSystem=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function t(t,o){void 0===t&&(t=0),void 0===o&&(o=1e3),this.rawValue=Math.round(t*o),this.precision=o}return t.prototype.add=function(o){return this.rawValue+=o instanceof t?o.rawValue:Math.round(o*this.precision),this},t.prototype.sub=function(o){return this.rawValue-=o instanceof t?o.rawValue:Math.round(o*this.precision),this},t.prototype.mul=function(o){return this.rawValue=o instanceof t?Math.round(this.rawValue*o.rawValue/o.precision):Math.round(this.rawValue*o),this},t.prototype.div=function(o){return this.rawValue=o instanceof t?Math.round(this.rawValue/o.rawValue*this.precision):Math.round(this.rawValue/o),this},t.prototype.lt=function(o){return o instanceof t?this.rawValue<o.rawValue:this.rawValue<Math.round(o*this.precision)},t.prototype.gt=function(o){return o instanceof t?this.rawValue>o.rawValue:this.rawValue>Math.round(o*this.precision)},t.prototype.gte=function(o){return o instanceof t?this.rawValue>=o.rawValue:this.rawValue>=Math.round(o*this.precision)},t.prototype.lte=function(o){return o instanceof t?this.rawValue<=o.rawValue:this.rawValue<=Math.round(o*this.precision)},t.prototype.neg=function(){var o=new t;return o.rawValue=-this.rawValue,o},t.prototype.toFloat=function(){return this.rawValue/this.precision},t.add=function(o,i){var n=new t;return n.rawValue=i instanceof t?o.rawValue+i.rawValue:o.rawValue+Math.round(i*o.precision),n},t.sub=function(o,i){var n=new t;return n.rawValue=i instanceof t?o.rawValue-i.rawValue:o.rawValue-Math.round(i*o.precision),n},t.mul=function(o,i){var n=new t;return n.rawValue=i instanceof t?Math.round(o.rawValue*i.rawValue/i.precision):Math.round(o.rawValue*i),n},t.div=function(o,i){var n=new t;return n.rawValue=i instanceof t?Math.round(o.rawValue/i.rawValue*o.precision):Math.round(o.rawValue/i),n},t.max=function(t,o){return t.gt(o)?t:o},t.min=function(t,o){return t.lt(o)?t:o},t.from=function(o){return new t("number"==typeof o?o:parseFloat(o))},t}();t.FixedPoint=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.position=new o.Vector2,i.velocity=new o.Vector2,i.mass=new o.FixedPoint,i.size=new o.Vector2,i}return __extends(i,t),i}(t.Component);o.RigidBody=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(o,i){void 0===o&&(o=0),void 0===i&&(i=0),this.width=new t.FixedPoint(o),this.height=new t.FixedPoint(i)}return o.prototype.add=function(t){return new o(this.width.toFloat()+t.width.toFloat(),this.height.toFloat()+t.height.toFloat())},o.prototype.subtract=function(t){return new o(this.width.toFloat()-t.width.toFloat(),this.height.toFloat()-t.height.toFloat())},o.prototype.multiply=function(t){return new o(this.width.toFloat()*t,this.height.toFloat()*t)},o.prototype.divide=function(t){return new o(this.width.toFloat()/t,this.height.toFloat()/t)},o}();t.Size=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function t(t){this.setPool=[],this.cellSize=t,this.hashTable=new Map,this.objectTable=new Map}return t.prototype.hash=function(t,o){return 73856093*t^19349663*o},t.prototype.getSetFromPool=function(){return this.setPool.length>0?this.setPool.pop():new Set},t.prototype.returnSetToPool=function(t){t.clear(),this.setPool.push(t)},t.prototype.insert=function(t){for(var o=Math.floor(t.position.x.toFloat()/this.cellSize),i=Math.floor(t.position.y.toFloat()/this.cellSize),n=Math.floor((t.position.x.toFloat()+t.width.toFloat())/this.cellSize),e=Math.floor((t.position.y.toFloat()+t.height.toFloat())/this.cellSize),r=[],s=o;s<=n;s++)for(var a=i;a<=e;a++){var l=this.hash(s,a);r.push(l);var u=this.hashTable.get(l);u||(u=this.getSetFromPool(),this.hashTable.set(l,u)),u.add(t)}this.objectTable.set(t,r)},t.prototype.retrieve=function(t,o){var i,n,e,r,s=this.objectTable.get(t);if(s)try{for(var a=__values(s),l=a.next();!l.done;l=a.next()){var u=l.value,h=this.hashTable.get(u);if(h)try{for(var c=__values(h),p=c.next();!p.done;p=c.next()){o(p.value)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}}}catch(t){i={error:t}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}},t.prototype.retrieveAll=function(){var t,o,i=[];try{for(var n=__values(this.hashTable.values()),e=n.next();!e.done;e=n.next()){var r=e.value;i.push.apply(i,__spread(r))}}catch(o){t={error:o}}finally{try{e&&!e.done&&(o=n.return)&&o.call(n)}finally{if(t)throw t.error}}return i},t.prototype.remove=function(t){var o,i,n=this.objectTable.get(t);if(n){try{for(var e=__values(n),r=e.next();!r.done;r=e.next()){var s=r.value,a=this.hashTable.get(s);a&&(a.delete(t),0===a.size&&(this.returnSetToPool(a),this.hashTable.delete(s)))}}catch(t){o={error:t}}finally{try{r&&!r.done&&(i=e.return)&&i.call(e)}finally{if(o)throw o.error}}this.objectTable.delete(t)}},t.prototype.clear=function(){var t,o;try{for(var i=__values(this.hashTable.values()),n=i.next();!n.done;n=i.next()){var e=n.value;this.returnSetToPool(e)}}catch(o){t={error:o}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}this.hashTable.clear(),this.objectTable.clear()},t}();t.SpatialHash=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.onInitialize=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.position=new o.Vector2(t,i)},i}(t.Component);o.Transform=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(o,i){void 0===o&&(o=0),void 0===i&&(i=0),this.x=o instanceof t.FixedPoint?o:new t.FixedPoint(o),this.y=i instanceof t.FixedPoint?i:new t.FixedPoint(i)}return o.prototype.add=function(t){return new o(this.x.toFloat()+t.x.toFloat(),this.y.toFloat()+t.y.toFloat())},o.prototype.subtract=function(t){return new o(this.x.toFloat()-t.x.toFloat(),this.y.toFloat()-t.y.toFloat())},o.prototype.multiply=function(t){return new o(this.x.toFloat()*t,this.y.toFloat()*t)},o.prototype.divide=function(t){return new o(this.x.toFloat()/t,this.y.toFloat()/t)},o.prototype.multiplyScalar=function(t){return new o(this.x.toFloat()*t,this.y.toFloat()*t)},o.prototype.divideScalar=function(t){return new o(this.x.toFloat()/t,this.y.toFloat()/t)},o.prototype.length=function(){return new t.FixedPoint(Math.sqrt(this.x.toFloat()*this.x.toFloat()+this.y.toFloat()*this.y.toFloat()))},o.prototype.lengthSquared=function(){return new t.FixedPoint(this.x.toFloat()*this.x.toFloat()+this.y.toFloat()*this.y.toFloat())},o.prototype.normalize=function(){var t=this.length();return new o(this.x.div(t),this.y.div(t))},o.prototype.dot=function(o){return new t.FixedPoint(this.x.toFloat()*o.x.toFloat()+this.y.toFloat()*o.y.toFloat())},o.prototype.cross=function(o){return new t.FixedPoint(this.x.toFloat()*o.y.toFloat()-this.y.toFloat()*o.x.toFloat())},o.prototype.distanceTo=function(o){var i=this.x.sub(o.x),n=this.y.sub(o.y);return new t.FixedPoint(Math.sqrt(i.toFloat()*i.toFloat()+n.toFloat()*n.toFloat()))},o}();t.Vector2=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(o,i,n){void 0===o&&(o=new t.FixedPoint(0,-9.81)),void 0===i&&(i=new t.FixedPoint(1,60)),this.cellSize=n,this.name="PhysicsPlugin",this.gravity=o,this.timeStep=i,this.bodies=[]}return o.prototype.onInit=function(o){o.systemManager.registerSystem(new t.CollisionResponseSystem(o.entityManager,this.cellSize))},o.prototype.onUpdate=function(t){this.step()},o.prototype.addBody=function(t){this.bodies.push(t)},o.prototype.step=function(){},o}();t.World=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.getBounds=function(){return{position:new o.Vector2,width:new o.FixedPoint,height:new o.FixedPoint,entity:this.entity}},i}(t.Component);o.Collider=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(o){function i(){var i=null!==o&&o.apply(this,arguments)||this;return i.dependencies=[t.Transform],i}return __extends(i,o),i.prototype.onInitialize=function(o){this.size=o,this.transform=this.entity.getComponent(t.Transform)},i.prototype.getBounds=function(){return{position:this.transform.position,width:this.size.width,height:this.size.height,entity:this.entity}},i}(t.Collider);t.BoxCollider=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function t(){}return Object.defineProperty(t.prototype,"width",{get:function(){return this.radius.mul(2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.radius.mul(2)},enumerable:!0,configurable:!0}),t.prototype.area=function(){return this.radius.mul(this.radius).mul(Math.PI)},t.prototype.circumference=function(){return this.radius.mul(2).mul(Math.PI)},t.prototype.containsPoint=function(t){return this.position.distanceTo(t).lte(this.radius)},t.prototype.intersects=function(t){return this.position.distanceTo(t.position).lte(this.radius.add(t.radius))},t}();t.Circle=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function t(){}return t.prototype.area=function(){return this.width.mul(this.height)},t.prototype.containsPoint=function(t){return t.x.gte(this.position.x)&&t.x.lte(this.position.x.add(this.width))&&t.y.gte(this.position.y)&&t.y.lte(this.position.y.add(this.height))},t.prototype.intersects=function(t){return!(t.position.x.add(t.width).lt(this.position.x)||t.position.y.add(t.height).lt(this.position.y)||t.position.x.gt(this.position.x.add(this.width))||t.position.y.gt(this.position.y.add(this.height)))},t}();t.Rectangle=o}(t.physics||(t.physics={}))}(gs||(gs={}));