window.gs={};var __read=this&&this.__read||function(t,i){var e="function"==typeof Symbol&&t[Symbol.iterator];if(!e)return t;var r,n,s=e.call(t),o=[];try{for(;(void 0===i||i-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(e=s.return)&&e.call(s)}finally{if(n)throw n.error}}return o},__spread=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(__read(arguments[i]));return t},__values=this&&this.__values||function(t){var i="function"==typeof Symbol&&t[Symbol.iterator],e=0;return i?i.call(t):{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}};!function(t){var i=function(){function t(t,i,e,r){this.minX=t,this.maxX=i,this.minY=e,this.maxY=r}return t.prototype.union=function(i){return new t(Math.min(this.minX,i.minX),Math.max(this.maxX,i.maxX),Math.min(this.minY,i.minY),Math.max(this.maxY,i.maxY))},t.prototype.area=function(){return(this.maxX-this.minX)*(this.maxY-this.minY)},t.prototype.intersects=function(t){return!(this.minX>t.maxX||this.maxX<t.minX||this.minY>t.maxY||this.maxY<t.minY)},t.prototype.computeCollisionTime=function(t){var i,e,r,n,s=t.velocityX-this.velocityX,o=t.velocityY-this.velocityY;s>0?(i=(this.minX-t.maxX)/s,r=(this.maxX-t.minX)/s):(i=(this.maxX-t.minX)/s,r=(this.minX-t.maxX)/s),o>0?(e=(this.minY-t.maxY)/o,n=(this.maxY-t.minY)/o):(e=(this.maxY-t.minY)/o,n=(this.minY-t.maxY)/o);var a=Math.max(i,e),h=Math.min(r,n);return a<h&&a<1&&h>0?a:1/0},t.prototype.clone=function(){var i=new t(this.minX,this.maxX,this.minY,this.maxY);return i.velocityX=this.velocityX,i.velocityY=this.velocityY,i},t}();t.AABB=i}(gs||(gs={})),function(t){var i=function(){function i(i){this.left=null,this.right=null,this.object=i||null,this.bounds=i||new t.AABB(1/0,-1/0,1/0,-1/0)}return i.prototype.insert=function(t){if(!this.left&&!this.right)return this.object=t,this.bounds=t,!1;var i=this.left.bounds.union(t),e=this.right.bounds.union(t);if(i.area()*(this.left.size()+1)-this.bounds.area()*this.size()<e.area()*(this.right.size()+1)-this.bounds.area()*this.size()){var r=this.left.insert(t);return this.bounds=this.bounds.union(t),r}r=this.right.insert(t);return this.bounds=this.bounds.union(t),r},i.prototype.remove=function(t){if(this.object===t)return this.object=null,!0;if(this.left&&this.right){var i=this.left.remove(t)||this.right.remove(t);return i&&this.updateBounds(),i}return!1},i.prototype.updateBounds=function(){this.bounds=this.left.bounds.union(this.right.bounds)},i.prototype.query=function(t){if(!this.bounds.intersects(t))return[];var i=[];return this.object?this.object.intersects(t)&&i.push(this.object):(this.left&&i.push.apply(i,__spread(this.left.query(t))),this.right&&i.push.apply(i,__spread(this.right.query(t)))),i},i.prototype.size=function(){return this.left||this.right?this.left.size()+this.right.size():1},i.prototype.getObjects=function(){if(this.object)return[this.object];var t=[];return this.left&&t.push.apply(t,__spread(this.left.getObjects())),this.right&&t.push.apply(t,__spread(this.right.getObjects())),t},i}();t.BVHNode=i;var e=function(){function t(t){var e,r;this.root=new i;try{for(var n=__values(t),s=n.next();!s.done;s=n.next()){var o=s.value;this.insert(o)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}}return t.prototype.insert=function(t){var e,r;if(this.root.insert(t)){var n=this.root.getObjects();this.root=new i;try{for(var s=__values(n),o=s.next();!o.done;o=s.next()){var a=o.value;this.root.insert(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}}},t.prototype.query=function(t){return this.root.query(t)},t.prototype.filterPairs=function(t){var i,e,r=[];try{for(var n=__values(t),s=n.next();!s.done;s=n.next()){var o=s.value,a=o[0],h=o[1];-1!=this.query(a).indexOf(h)&&r.push(o)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(i)throw i.error}}return r},t.prototype.remove=function(t){var e,r;if(this.root.remove(t)){var n=this.root.getObjects();this.root=new i;try{for(var s=__values(n),o=s.next();!o.done;o=s.next()){var a=o.value;this.root.insert(a)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}}},t.prototype.update=function(t,i){this.remove(t),t.minX=i.minX,t.minY=i.minY,t.maxX=i.maxX,t.maxY=i.maxY,this.insert(t)},t}();t.BVH=e}(gs||(gs={})),function(t){var i=function(){function i(i,e,r,n){this.aabbs=i,this.quadtree=new t.QuadTree(e,r,n),this.bvh=new t.BVH(i)}return i.prototype.step=function(i){var e,r,n=this.quadtree.queryPairs();n=t.SweepAndPrune.sweepAndPrune(n),n=this.bvh.filterPairs(n);try{for(var s=__values(n),o=s.next();!o.done;o=s.next()){var a=o.value,h=__read(a,2),u=h[0],l=h[1],c=__read(t.TimeBaseCollisionDetection.handleCollision(u,l),2),f=c[0],y=c[1];this.quadtree.update(u,f),this.bvh.update(u,f),this.quadtree.update(l,y),this.bvh.update(l,y)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(e)throw e.error}}},i}();t.PhysicsEngine=i}(gs||(gs={})),function(t){var i=function(){return function(t,i){this.x=t,this.y=i}}();t.Point=i}(gs||(gs={})),function(t){var i=function(){function i(i,e,r){this.boundary=i,this.capacity=e,this.nw=null,this.ne=null,this.sw=null,this.se=null,this.spatialHash=new t.SpatialHash(r)}return i.prototype.insert=function(t){return!!this.boundary.intersectsAABB(t)&&(this.spatialHash.size()<this.capacity?(this.spatialHash.insert(t),!0):(null===this.nw&&this.subdivide(),this.nw.insert(t)||this.ne.insert(t)||this.sw.insert(t)||this.se.insert(t)))},i.prototype.subdivide=function(){var e,r,n=this.boundary.x,s=this.boundary.y,o=this.boundary.width/2,a=this.boundary.height/2,h=new t.Rectangle(n,s,o,a),u=new t.Rectangle(n+o,s,o,a),l=new t.Rectangle(n,s+a,o,a),c=new t.Rectangle(n+o,s+a,o,a);this.nw=new i(h,this.capacity,this.spatialHash.cellSize),this.ne=new i(u,this.capacity,this.spatialHash.cellSize),this.sw=new i(l,this.capacity,this.spatialHash.cellSize),this.se=new i(c,this.capacity,this.spatialHash.cellSize);var f=this.spatialHash.queryPairs().reduce(function(t,i){return t.concat(i)},[]);try{for(var y=__values(f),v=y.next();!v.done;v=y.next()){var m=v.value;this.nw.insert(m)||this.ne.insert(m)||this.sw.insert(m)||this.se.insert(m)}}catch(t){e={error:t}}finally{try{v&&!v.done&&(r=y.return)&&r.call(y)}finally{if(e)throw e.error}}this.spatialHash.clear()},i.prototype.remove=function(t){return!!this.boundary.intersectsAABB(t)&&(!!this.spatialHash.remove(t)||null!==this.nw&&(this.nw.remove(t)||this.ne.remove(t)||this.sw.remove(t)||this.se.remove(t)))},i.prototype.query=function(t,i){return void 0===i&&(i=[]),this.boundary.intersects(t)?(i.push.apply(i,__spread(this.spatialHash.query(t.x,t.y))),null===this.nw?i:(this.nw.query(t,i),this.ne.query(t,i),this.sw.query(t,i),this.se.query(t,i),i)):i},i.prototype.queryPairs=function(){var t,i,e=[];if(this.nw){var r=this.nw.queryPairs(),n=this.ne.queryPairs(),s=this.sw.queryPairs(),o=this.se.queryPairs();e=e.concat(r,n,s,o)}else{var a=this.spatialHash.queryPairs();try{for(var h=__values(a),u=h.next();!u.done;u=h.next()){var l=u.value;e.push(l)}}catch(i){t={error:i}}finally{try{u&&!u.done&&(i=h.return)&&i.call(h)}finally{if(t)throw t.error}}}return e},i.prototype.update=function(t,i){return!!this.remove(t)&&(t.minX=i.minX,t.maxX=i.maxX,t.minY=i.minY,t.maxY=i.maxY,this.insert(t))},i}();t.QuadTree=i}(gs||(gs={})),function(t){var i=function(){function t(t,i,e,r){this.x=t,this.y=i,this.width=e,this.height=r}return t.prototype.contains=function(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height},t.prototype.intersects=function(t){return!(t.x>=this.x+this.width||t.x+t.width<=this.x||t.y>=this.y+this.height||t.y+t.height<=this.y)},t.prototype.intersectsAABB=function(t){return this.x<t.maxX&&this.y>t.minX&&this.width<t.maxY&&this.height>t.minY},t}();t.Rectangle=i}(gs||(gs={})),function(t){var i=function(){function t(t){this.cellSize=t,this.buckets=new Map}return t.prototype.size=function(){var t,i,e=0;try{for(var r=__values(this.buckets.values()),n=r.next();!n.done;n=r.next()){e+=n.value.length}}catch(i){t={error:i}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}return e},t.prototype.hash=function(t,i){return Math.floor(t/this.cellSize)+","+Math.floor(i/this.cellSize)},t.prototype.insert=function(t){for(var i=t.minX,e=t.minY,r=t.maxX,n=t.maxY,s=i;s<=r;s+=this.cellSize)for(var o=e;o<=n;o+=this.cellSize){var a=this.hash(s,o);this.buckets.has(a)||this.buckets.set(a,[]),this.buckets.get(a).push(t)}},t.prototype.remove=function(t){for(var i=t.minX,e=t.minY,r=t.maxX,n=t.maxY,s=i;s<=r;s+=this.cellSize)for(var o=e;o<=n;o+=this.cellSize){var a=this.hash(s,o),h=this.buckets.get(a);if(h){var u=h.indexOf(t);if(-1!==u)return h.splice(u,1),0===h.length&&this.buckets.delete(a),!0}}return!1},t.prototype.query=function(t,i){var e=this.hash(t,i);return this.buckets.get(e)||[]},t.prototype.queryPairs=function(){var t=[];return this.buckets.forEach(function(i,e){for(var r=0;r<i.length;r++)for(var n=r+1;n<i.length;n++)t.push([i[r],i[n]])}),t},t.prototype.clear=function(){this.buckets.clear()},t}();t.SpatialHash=i}(gs||(gs={})),function(t){var i=function(){function t(){}return t.sweepAndPrune=function(t){var i,e,r=[];try{for(var n=__values(t),s=n.next();!s.done;s=n.next()){var o=s.value;r.push(o[0]),r.push(o[1])}}catch(t){i={error:t}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(i)throw i.error}}r=this.mergeSort(r,function(t,i){return t.minX-i.minX});for(var a=[],h=0;h<r.length;h++)for(var u=r[h],l=h+1;l<r.length;l++){var c=r[l];if(c.minX>u.maxX)break;u.minY<=c.maxY&&u.maxY>=c.minY&&a.push([u,c])}return a},t.mergeSort=function(t,i){if(t.length<=1)return t;var e=Math.floor(t.length/2),r=this.mergeSort(t.slice(0,e),i),n=this.mergeSort(t.slice(e),i);return this.merge(r,n,i)},t.merge=function(t,i,e){for(var r=[],n=0,s=0;n<t.length&&s<i.length;)e(t[n],i[s])<=0?(r.push(t[n]),n++):(r.push(i[s]),s++);return r.concat(t.slice(n)).concat(i.slice(s))},t}();t.SweepAndPrune=i}(gs||(gs={})),function(t){var i=function(){function t(){}return t.handleCollision=function(t,i){var e=t.computeCollisionTime(i),r=t.clone(),n=i.clone();return e<1&&(t.minX+=t.velocityX*e,t.minY+=t.velocityY*e,t.maxX+=t.velocityX*e,t.maxY+=t.velocityY*e,i.minX+=i.velocityX*e,i.minY+=i.velocityY*e,i.maxX+=i.velocityX*e,i.maxY+=i.velocityY*e),[r,n]},t.handleCollisions=function(t){for(var i,e,r=[],n=0;n<t.length;n++)for(var s=n+1;s<t.length;s++)r.push([t[n],t[s]]);for(var o=function(){var t,i,e=1/0,n=null;try{for(var s=__values(r),o=s.next();!o.done;o=s.next()){var a=o.value,h=a[0].computeCollisionTime(a[1]);h<e&&(e=h,n=a)}}catch(i){t={error:i}}finally{try{o&&!o.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}if(null===n)return"break";var u=__read(n,2),l=u[0],c=u[1];l.minX+=l.velocityX*e,l.minY+=l.velocityY*e,l.maxX+=l.velocityX*e,l.maxY+=l.velocityY*e,c.minX+=c.velocityX*e,c.minY+=c.velocityY*e,c.maxX+=c.velocityX*e,c.maxY+=c.velocityY*e;var f=(l.minX+l.maxX)/2-(c.minX+c.maxX)/2,y=(l.minY+l.maxY)/2-(c.minY+c.maxY)/2,v=Math.sqrt(f*f+y*y);f/=v,y/=v;var m=c.velocityX-l.velocityX,p=c.velocityY-l.velocityY,d=m*f+p*y;if(d>0){var x=2*d*f-m,g=2*d*y-p;l.velocityX-=x,l.velocityY-=g,c.velocityX+=x,c.velocityY+=g}r=r.filter(function(t){return t!==n})};;){if("break"===o())break}try{for(var a=__values(t),h=a.next();!h.done;h=a.next()){var u=h.value;u.minX+=u.velocityX,u.minY+=u.velocityY,u.maxX+=u.velocityX,u.maxY+=u.velocityY}}catch(t){i={error:t}}finally{try{h&&!h.done&&(e=a.return)&&e.call(a)}finally{if(i)throw i.error}}},t}();t.TimeBaseCollisionDetection=i}(gs||(gs={}));