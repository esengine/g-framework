window.gs.physics={};var __values=this&&this.__values||function(t){var i="function"==typeof Symbol&&t[Symbol.iterator],o=0;return i?i.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}};window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o])};return function(i,o){function n(){this.constructor=i}t(i,o),i.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();var gs,__read=this&&this.__read||function(t,i){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,e,r=o.call(t),s=[];try{for(;(void 0===i||i-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){e={error:t}}finally{try{n&&!n.done&&(o=r.return)&&o.call(r)}finally{if(e)throw e.error}}return s},__spread=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(__read(arguments[i]));return t};!function(t){!function(t){var i=function(){function i(t,i){this.shape1=t,this.shape2=i}return i.prototype.epa=function(){for(var i,o,n=[];;){var e=n[0];try{for(var r=__values(n),s=r.next();!s.done;s=r.next()){var a=s.value;a.distance.lt(e.distance)&&(e=a)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}var l=e.pointB.sub(e.pointA).perp(),h=this.support(l);if(h.sub(e.pointA).dot(l).lte(0)||h.distanceTo(t.Vector2.zero()).sub(e.distance).lte(0))return l.mul(e.distance);this.addPointToPolytope(n,h)}},i.prototype.gjk=function(){var i=new t.Vector2(1,0),o=new t.Simplex;for(o.add(this.support(i)),t.Vector2.negate(i);;){if(o.add(this.support(i)),o.vertices[0].dot(i).toFloat()<=0)return!1;if(this.updateSimplexAndDirection(o,i))return!0}},i.prototype.updateSimplexAndDirection=function(t,i){if(2===t.vertices.length){var o=t.vertices[1],n=(e=t.vertices[0]).negate();(s=o.sub(e)).cross(n).gt(0)?i.setR(s.perp().negate()):i.setR(s.perp())}else if(3===t.vertices.length){var e,r=t.vertices[2],s=(o=t.vertices[1],n=(e=t.vertices[0]).negate(),o.sub(e)),a=r.sub(e);s.cross(a);if(s.cross(n).gt(0))t.vertices.splice(2,1),i.setR(s.perp().negate());else{if(!a.cross(n).gt(0))return!0;t.vertices.splice(1,1),i.setR(a.perp())}}return!1},i.prototype.addPointToPolytope=function(i,o){for(var n,e,r,s,a=[],l=0;l<i.length;l++){var h=(f=i[l]).pointA,u=f.pointB.sub(h),c=o.sub(h);u.cross(c).gt(0)&&a.push(f)}try{for(var d=__values(a),p=d.next();!p.done;p=d.next()){var f=p.value,y=i.indexOf(f);-1!==y&&i.splice(y,1)}}catch(t){n={error:t}}finally{try{p&&!p.done&&(e=d.return)&&e.call(d)}finally{if(n)throw n.error}}try{for(var v=__values(a),x=v.next();!x.done;x=v.next()){f=x.value;i.push(new t.Edge(f.point1,o)),i.push(new t.Edge(o,f.point2))}}catch(t){r={error:t}}finally{try{x&&!x.done&&(s=v.return)&&s.call(v)}finally{if(r)throw r.error}}},i.prototype.support=function(t){var i=this.shape1.getFarthestPointInDirection(t),o=this.shape2.getFarthestPointInDirection(t.negate());return i.sub(o)},i}();t.CollisionDetector=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(i,o,n,e){var r=t.call(this,i)||this;return r.entity1=o,r.entity2=n,r.velocities=e,r}return __extends(o,t),o.prototype.reset=function(){t.prototype.reset.call(this),this.entity1=null,this.entity2=null,this.velocities={v1:new i.Vector2(0,0),v2:new i.Vector2(0,0)}},o.prototype.getEntity1=function(){return this.entity1},o.prototype.getEntity2=function(){return this.entity2},o.prototype.getVelocities=function(){return this.velocities},o}(t.Event);i.CollisionEvent=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(){function o(){t.GlobalEventEmitter.on("collision",this.handleCollision.bind(this))}return o.prototype.handleCollision=function(t){var o=t.data,n=o.entity1,e=o.entity2,r=o.velocities;n.getComponent(i.RigidBody).velocity=r.v1,e.getComponent(i.RigidBody).velocity=r.v2},o}();i.CollisionHandlerSystem=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(o){function n(n,e){var r=o.call(this,n,0,t.Matcher.empty().all(i.RigidBody,i.Collider))||this;return r.processed=new Map,r.collisionPairs=[],r.dynamicTree=new i.DynamicTree,r.updateInterval=e,r}return __extends(n,o),n.prototype.update=function(t){this.resetForNewFrame();var i=this.initializeNodesAndEntities(t);this.processCollisions(i)},n.prototype.resetForNewFrame=function(){this.dynamicTree.clear(),this.processed.clear(),this.collisionPairs.length=0},n.prototype.initializeNodesAndEntities=function(o){var n,e,r=new Map,s=t.TimeManager.getInstance().deltaTime,a=[];try{for(var l=__values(o),h=l.next();!h.done;h=l.next()){var u=h.value,c=u.getComponent(i.Collider),d=u.getComponent(i.RigidBody);d&&!d.isKinematic&&d.update(s);var p={children:[],height:0,leaf:!0,bounds:c.getBounds()};a.push(p),r.set(p,u)}}catch(t){n={error:t}}finally{try{h&&!h.done&&(e=l.return)&&e.call(l)}finally{if(n)throw n.error}}return this.dynamicTree.load(a),r},n.prototype.processCollisions=function(t){var i,o,n,e,r=new Set;try{for(var s=__values(t.keys()),a=s.next();!a.done;a=s.next()){var l=a.value,h=t.get(l),u=h.getId(),c=this.processed.get(u);c||(c=new Set,this.processed.set(u,c));var d=this.dynamicTree.search(l.bounds);try{for(var p=__values(d),f=p.next();!f.done;f=p.next()){var y=f.value,v=t.get(y),x=v.getId();if(u!==x){var g=u<x?u+","+x:x+","+u;r.has(g)||(this.collisionPairs.push([h,v]),r.add(g))}}}catch(t){n={error:t}}finally{try{f&&!f.done&&(e=p.return)&&e.call(p)}finally{if(n)throw n.error}}}}catch(t){i={error:t}}finally{try{a&&!a.done&&(o=s.return)&&o.call(s)}finally{if(i)throw i.error}}this.resolveCollisions()},n.prototype.resolveCollisions=function(){var t,o;try{for(var n=__values(this.collisionPairs),e=n.next();!e.done;e=n.next()){var r=__read(e.value,2),s=r[0],a=r[1],l=s.getComponent(i.Collider),h=a.getComponent(i.Collider);l.handleCollision(a),h.handleCollision(s);var u=s.getComponent(i.RigidBody),c=a.getComponent(i.RigidBody);u&&!u.isKinematic&&c&&!c.isKinematic&&this.resolveDynamicCollision(u,c,l,h)}}catch(i){t={error:i}}finally{try{e&&!e.done&&(o=n.return)&&o.call(n)}finally{if(t)throw t.error}}this.handleCollisionExits()},n.prototype.handleCollisionExits=function(){var t,o,n,e,r,s;try{for(var a=__values(this.processed.values()),l=a.next();!l.done;l=a.next()){var h=l.value;try{for(var u=__values(h),c=u.next();!c.done;c=u.next()){var d=c.value,p=this.entityManager.getEntity(d),f=p.getComponent(i.Collider);try{for(var y=__values(f.collidingEntities),v=y.next();!v.done;v=y.next()){var x=v.value;h.has(x.getId())||(f.handleCollisionExit(x),x.getComponent(i.Collider).handleCollisionExit(p))}}catch(t){r={error:t}}finally{try{v&&!v.done&&(s=y.return)&&s.call(y)}finally{if(r)throw r.error}}}}catch(t){n={error:t}}finally{try{c&&!c.done&&(e=u.return)&&e.call(u)}finally{if(n)throw n.error}}}}catch(i){t={error:i}}finally{try{l&&!l.done&&(o=a.return)&&o.call(a)}finally{if(t)throw t.error}}},n.prototype.resolveDynamicCollision=function(t,o,n,e){var r=n.getCollisionNormal(e),s=t.velocity.dot(r),a=o.velocity.dot(r),l=i.FixedPoint.div(i.FixedPoint.add(i.FixedPoint.mul(s,i.FixedPoint.sub(t.mass,o.mass)),i.FixedPoint.mul(i.FixedPoint.mul(new i.FixedPoint(2),o.mass),a)),i.FixedPoint.add(t.mass,o.mass)),h=i.FixedPoint.div(i.FixedPoint.add(i.FixedPoint.mul(a,i.FixedPoint.sub(o.mass,t.mass)),i.FixedPoint.mul(i.FixedPoint.mul(new i.FixedPoint(2),t.mass),s)),i.FixedPoint.add(t.mass,o.mass));t.velocity=t.velocity.add(r.mul(i.FixedPoint.sub(l,s))),o.velocity=o.velocity.add(r.mul(i.FixedPoint.sub(h,a)))},n}(t.System);i.CollisionResponseSystem=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){function i(i,n,e,r,s){s||(s=o(null)),s.bounds=new t.BoxBounds(t.Vector2.zero(),new t.FixedPoint,new t.FixedPoint,null);for(var a=t.FixedPoint.from(1/0),l=t.FixedPoint.from(1/0),h=t.FixedPoint.from(-1/0),u=t.FixedPoint.from(-1/0),c=n;c<e;c++){var d=r(i.children[c]);a=t.FixedPoint.min(a,d.position.x),l=t.FixedPoint.min(l,d.position.y),h=t.FixedPoint.max(h,d.position.x.add(d.width)),u=t.FixedPoint.max(u,d.position.y.add(d.height))}var p=new t.BoxBounds(new t.Vector2(a.toFloat(),l.toFloat()),h.sub(a),u.sub(l),s.bounds.entity);return s.bounds=p,s}function o(i){return{children:i,height:1,leaf:!0,bounds:new t.BoxBounds(t.Vector2.zero(),new t.FixedPoint,new t.FixedPoint,null)}}function n(t,i,o,r,s){for(;r>o;){if(r-o>600){var a=r-o+1,l=i-o+1,h=Math.log(a),u=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*u*(a-u)/a)*Math.sign(l-a/2);n(t,i,Math.max(o,Math.floor(i-l*u/a+c)),Math.min(r,Math.floor(i+(a-l)*u/a+c)),s)}var d=t[i],p=o,f=r;for(e(t,o,i),s(t[r],d).gt(0)&&e(t,o,r);p<f;){for(e(t,p,f),p++,f--;s(t[p],d).lt(0);)p++;for(;s(t[f],d).gt(0);)f--}s(t[o],d).equals(0)?e(t,o,f):e(t,++f,r),f<=i&&(o=f+1),i<=f&&(r=f-1)}}function e(t,i,o){var n=t[i];t[i]=t[o],t[o]=n}t.findItem=function(t,i,o){if(!o)return i.indexOf(t);for(var n=0;n<i.length;n++)if(o(t,i[n]))return n;return-1},t.calcBounds=function(t,o){i(t,0,t.children.length,o,t)},t.distBounds=i,t.extend=function(i,o){var n=t.FixedPoint.min(i.position.x,o.position.x),e=t.FixedPoint.min(i.position.y,o.position.y),r=t.FixedPoint.max(i.position.x.add(i.width),o.position.x.add(o.width)),s=t.FixedPoint.max(i.position.y.add(i.height),o.position.y.add(o.height));return i.position.x=n,i.position.y=e,i.width=r.sub(n),i.height=s.sub(e),i},t.compareNodeMinX=function(t,i){return t.bounds.position.x.sub(i.bounds.position.x)},t.compareNodeMinY=function(t,i){return t.bounds.position.y.sub(i.bounds.position.y)},t.boundsArea=function(t){var i=t.bounds;return i.width.mul(i.height)},t.boundsMargin=function(t){var i=t.bounds;return i.width.add(i.height)},t.enlargedArea=function(i,o){return t.FixedPoint.max(o.position.x.add(o.width),i.position.x.add(i.width)).sub(t.FixedPoint.min(o.position.x,i.position.x)).mul(t.FixedPoint.max(o.position.y.add(o.height),i.position.y.add(i.height)).sub(t.FixedPoint.min(o.position.y,i.position.y)))},t.intersectionArea=function(i,o){var n=t.FixedPoint.max(i.position.x,o.position.x),e=t.FixedPoint.max(i.position.y,o.position.y),r=t.FixedPoint.min(i.position.x.add(i.width),o.position.x.add(o.width)),s=t.FixedPoint.min(i.position.y.add(i.height),o.position.y.add(o.height));return t.FixedPoint.max(t.FixedPoint.from(0),r.sub(n)).mul(t.FixedPoint.max(t.FixedPoint.from(0),s.sub(e)))},t.createNode=o,t.multiSelect=function(t,i,o,e,r){for(var s=[i,o];s.length;)if(!((o=s.pop())-(i=s.pop())<=e)){var a=i+Math.ceil((o-i)/e/2)*e;n(t,a,i,o,r),s.push(i,a,a,o)}},t.quickselect=n,t.swap=e}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}return i.prototype.compareMinX=function(t,i){return t.bounds.position.x.sub(i.bounds.position.x)},i.prototype.compareMinY=function(t,i){return t.bounds.position.y.sub(i.bounds.position.y)},i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(t){var i=this.data,o=[];if(!t.intersects(i.bounds))return o;for(var n=[];i;){for(var e=0;e<i.children.length;e++){var r=i.children[e];t.intersects(r.bounds)&&(i.leaf?o.push(r):t.contains(r.bounds)?this._all(r,o):n.push(r))}i=n.pop()}return o},i.prototype.collides=function(t){var i=this.data;if(!t.intersects(i.bounds))return!1;for(var o=[];i;){for(var n=0;n<i.children.length;n++){var e=i.children[n];if(t.intersects(e.bounds)){if(i.leaf||t.contains(e.bounds))return!0;o.push(e)}}i=o.pop()}return!1},i.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var o=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===o.height)this._splitRoot(this.data,o);else{if(this.data.height<o.height){var n=this.data;this.data=o,o=n}this._insert(o,this.data.height-o.height-1,!0)}else this.data=o;return this},i.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},i.prototype.clear=function(){return this.data=t.createNode([]),this},i.prototype.remove=function(i,o){if(!i)return this;for(var n,e,r,s=this.data,a=(i.bounds,[]),l=[];s||a.length;){if(s||(s=a.pop(),e=a[a.length-1],n=l.pop(),r=!0),s.leaf){var h=t.findItem(i,s.children,o);if(-1!==h)return s.children.splice(h,1),a.push(s),this._condense(a),this}r||s.leaf||!i.bounds.contains(s.bounds)?e?(n++,s=e.children[n],r=!1):s=null:(a.push(s),l.push(n),n=0,e=s,s=s.children[0])}return this},i.prototype.toBounds=function(t){return t.bounds},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(t){return this.data=t,this},i.prototype._all=function(t,i){for(var o=[];t;)t.leaf?i.push.apply(i,__spread(t.children)):o.push.apply(o,__spread(t.children)),t=o.pop();return i},i.prototype._build=function(i,o,n,e){var r,s=n-o+1,a=this._maxEntries;if(s<=a)return r=t.createNode(i.slice(o,n+1)),t.calcBounds(r,this.toBounds),r;e||(e=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,e-1))),(r=t.createNode([])).leaf=!1,r.height=e;var l=Math.ceil(s/a),h=l*Math.ceil(Math.sqrt(a));t.multiSelect(i,o,n,h,this.compareMinX);for(var u=o;u<=n;u+=h){var c=Math.min(u+h-1,n);t.multiSelect(i,u,c,l,this.compareMinY);for(var d=u;d<=c;d+=l){var p=Math.min(d+l-1,c);r.children.push(this._build(i,d,p,e-1))}}return t.calcBounds(r,this.toBounds),r},i.prototype._chooseSubtree=function(i,o,n,e){for(;e.push(o),!o.leaf&&e.length-1!==n;){for(var r=new t.FixedPoint(1/0),s=new t.FixedPoint(1/0),a=void 0,l=0;l<o.children.length;l++){var h=o.children[l],u=t.boundsArea(h),c=t.enlargedArea(i,h.bounds).sub(u);c.lt(s)?(s=c,r=u<r?u:r,a=h):c===s&&u<r&&(r=u,a=h)}o=a||o.children[0]}return o},i.prototype._insert=function(i,o,n){var e=i.bounds,r=[],s=this._chooseSubtree(i.bounds,this.data,o,r);for(s.children.push(i),t.extend(s.bounds,e);o>=0&&r[o].children.length>this._maxEntries;)this._split(r,o),o--;this._adjustParentBounds(e,r,o)},i.prototype._split=function(i,o){var n=i[o],e=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,e);var s=this._chooseSplitIndex(n,r,e),a=t.createNode(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,t.calcBounds(n,this.toBounds),t.calcBounds(a,this.toBounds),o?i[o-1].children.push(a):this._splitRoot(n,a)},i.prototype._splitRoot=function(i,o){this.data=t.createNode([i,o]),this.data.height=i.height+1,this.data.leaf=!1,t.calcBounds(this.data,this.toBounds)},i.prototype._chooseSplitIndex=function(i,o,n){for(var e,r=new t.FixedPoint(1/0),s=new t.FixedPoint(1/0),a=o;a<=n-o;a++){var l=t.distBounds(i,0,a,this.toBounds),h=t.distBounds(i,a,n,this.toBounds),u=t.intersectionArea(l.bounds,h.bounds),c=t.boundsArea(l).add(t.boundsArea(h));u.lt(r)?(r=u,e=a,s=c<s?c:s):u===r&&c<s&&(s=c,e=a)}return e||n-o},i.prototype._chooseSplitAxis=function(i,o,n){var e=i.leaf?this.compareMinX:t.compareNodeMinX,r=i.leaf?this.compareMinY:t.compareNodeMinY;this._allDistMargin(i,o,n,function(t,i){return e(t,i).toFloat()})<this._allDistMargin(i,o,n,function(t,i){return r(t,i).toFloat()})&&i.children.sort(function(t,i){return e(t,i).toFloat()})},i.prototype._allDistMargin=function(i,o,n,e){i.children.sort(e);for(var r=this.toBounds,s=t.distBounds(i,0,o,r),a=t.distBounds(i,n-o,n,r),l=t.boundsMargin(s).add(t.boundsMargin(a)),h=o;h<n-o;h++){var u=i.children[h];t.extend(s.bounds,i.leaf?r(u):u.bounds),l=l.add(t.boundsMargin(s))}for(h=n-o-1;h>=o;h--){u=i.children[h];t.extend(a.bounds,i.leaf?r(u):u.bounds),l=l.add(t.boundsMargin(a))}return l},i.prototype._adjustParentBounds=function(i,o,n){for(var e=n;e>=0;e--)t.extend(o[e].bounds,i)},i.prototype._condense=function(i){for(var o=i.length-1,n=void 0;o>=0;o--)0===i[o].children.length?o>0?(n=i[o-1].children).splice(n.indexOf(i[o]),1):this.clear():t.calcBounds(i[o],this.toBounds)},i}();t.DynamicTree=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){return function(t,i){this.pointA=t,this.pointB=i;var o=i.sub(t),n=t.negate();this.distance=o.cross(n).div(o.length())}}();t.Edge=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=1e3),this.rawValue=Math.round(t*i),this.precision=i}return t.prototype.add=function(i){return i instanceof t?t.fromRawValue(this.rawValue+i.rawValue,this.precision):t.fromRawValue(this.rawValue+Math.round(i*this.precision),this.precision)},t.prototype.sub=function(i){var o=new t(0,this.precision);return o.rawValue=i instanceof t?this.rawValue-i.rawValue:this.rawValue-Math.round(i*this.precision),o},t.prototype.mul=function(i){var o=new t(0,this.precision);return o.rawValue=i instanceof t?Math.round(this.rawValue*i.rawValue/this.precision):Math.round(this.rawValue*i),o},t.prototype.div=function(i){var o=new t(0,this.precision);return o.rawValue=i instanceof t?Math.round(this.rawValue*this.precision/i.rawValue):Math.round(this.rawValue/i),o},t.prototype.abs=function(){var i=new t(0,this.precision);return i.rawValue=Math.abs(this.rawValue),i},t.prototype.pow=function(i){var o=Math.pow(this.toFloat(),i);return t.from(o)},t.prototype.equals=function(i){return i instanceof t?this.rawValue===i.rawValue:this.rawValue===Math.round(i*this.precision)},t.prototype.lt=function(i){return i instanceof t?this.rawValue<i.rawValue:this.rawValue<Math.round(i*this.precision)},t.prototype.gt=function(i){return i instanceof t?this.rawValue>i.rawValue:this.rawValue>Math.round(i*this.precision)},t.prototype.gte=function(i){return i instanceof t?this.rawValue>=i.rawValue:this.rawValue>=Math.round(i*this.precision)},t.prototype.lte=function(i){return i instanceof t?this.rawValue<=i.rawValue:this.rawValue<=Math.round(i*this.precision)},t.prototype.negate=function(){return t.fromRawValue(-this.rawValue,this.precision)},t.prototype.toFloat=function(){return this.rawValue/this.precision},t.prototype.toFixed=function(t){return void 0===t&&(t=0),this.toFloat().toFixed(t)},t.prototype.sqrt=function(){return t.from(Math.sqrt(this.toFloat()))},t.prototype.round=function(){return t.from(Math.round(this.toFloat()))},t.add=function(t,i){return t.add(i)},t.sub=function(t,i){return t.sub(i)},t.mul=function(t,i){return t.mul(i)},t.div=function(t,i){return t.div(i)},t.max=function(t,i){return t.gt(i)?t:i},t.min=function(t,i){return t.lt(i)?t:i},t.fromRawValue=function(i,o){void 0===o&&(o=1e3);var n=new t(0,o);return n.rawValue=i,n},t.from=function(i,o){return void 0===o&&(o=1e3),new t(i,o)},t}();t.FixedPoint=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t,i){this.min=t,this.max=i}return t.prototype.overlaps=function(t){return this.max>=t.min&&this.min<=t.max},t}();t.Projection=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.dependencies=[i.Transform],o}return __extends(o,t),o.prototype.onInitialize=function(t,o){void 0===t&&(t=new i.FixedPoint(1)),void 0===o&&(o=!1),this.mass=t,this.velocity=new i.Vector2,this.acceleration=new i.Vector2,this.isKinematic=o},o.prototype.applyForce=function(t){var o=new i.Vector2(t.x.div(this.mass),t.y.div(this.mass));this.acceleration=this.acceleration.add(o)},o.prototype.update=function(t){this.velocity=this.velocity.add(this.acceleration.mul(t));var o=this.entity.getComponent(i.Transform);o.position=o.position.add(this.velocity.mul(t)),this.acceleration.set(new i.FixedPoint(0),new i.FixedPoint(0))},o}(t.Component);i.RigidBody=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(){this.vertices=[]}return t.prototype.add=function(t){this.vertices.unshift(t)},t}();t.Simplex=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.width=new t.FixedPoint(i),this.height=new t.FixedPoint(o)}return i.prototype.add=function(t){return new i(this.width.toFloat()+t.width.toFloat(),this.height.toFloat()+t.height.toFloat())},i.prototype.subtract=function(t){return new i(this.width.toFloat()-t.width.toFloat(),this.height.toFloat()-t.height.toFloat())},i.prototype.multiply=function(t){return new i(this.width.toFloat()*t,this.height.toFloat()*t)},i.prototype.divide=function(t){return new i(this.width.toFloat()/t,this.height.toFloat()/t)},i}();t.Size=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t){this.setPool=[],this.cellSize=t,this.hashTable=new Map,this.objectTable=new Map}return t.prototype.hash=function(t,i){return 73856093*t^19349663*i},t.prototype.getSetFromPool=function(){return this.setPool.length>0?this.setPool.pop():new Set},t.prototype.returnSetToPool=function(t){t.clear(),this.setPool.push(t)},t.prototype.insert=function(t){for(var i=Math.floor(t.position.x.toFloat()/this.cellSize),o=Math.floor(t.position.y.toFloat()/this.cellSize),n=Math.floor((t.position.x.toFloat()+t.width.toFloat())/this.cellSize),e=Math.floor((t.position.y.toFloat()+t.height.toFloat())/this.cellSize),r=[],s=i;s<=n;s++)for(var a=o;a<=e;a++){var l=this.hash(s,a);r.push(l);var h=this.hashTable.get(l);h||(h=this.getSetFromPool(),this.hashTable.set(l,h)),h.add(t)}this.objectTable.set(t,r)},t.prototype.retrieve=function(t,i){var o,n,e,r,s=this.objectTable.get(t);if(s)try{for(var a=__values(s),l=a.next();!l.done;l=a.next()){var h=l.value,u=this.hashTable.get(h);if(u)try{for(var c=__values(u),d=c.next();!d.done;d=c.next()){i(d.value)}}catch(t){e={error:t}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}}}catch(t){o={error:t}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}},t.prototype.retrieveAll=function(){var t,i,o=[];try{for(var n=__values(this.hashTable.values()),e=n.next();!e.done;e=n.next()){var r=e.value;o.push.apply(o,__spread(r))}}catch(i){t={error:i}}finally{try{e&&!e.done&&(i=n.return)&&i.call(n)}finally{if(t)throw t.error}}return o},t.prototype.remove=function(t){var i,o,n=this.objectTable.get(t);if(n){try{for(var e=__values(n),r=e.next();!r.done;r=e.next()){var s=r.value,a=this.hashTable.get(s);a&&(a.delete(t),0===a.size&&(this.returnSetToPool(a),this.hashTable.delete(s)))}}catch(t){i={error:t}}finally{try{r&&!r.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}}this.objectTable.delete(t)}},t.prototype.clear=function(){var t,i;try{for(var o=__values(this.setPool),n=o.next();!n.done;n=o.next()){n.value.clear()}}catch(i){t={error:i}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(t)throw t.error}}this.hashTable.clear(),this.objectTable.clear()},t}();t.SpatialHash=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.onInitialize=function(t,o){void 0===t&&(t=0),void 0===o&&(o=0),this.position=new i.Vector2(t,o)},o}(t.Component);i.Transform=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.x=i instanceof t.FixedPoint?i:new t.FixedPoint(i),this.y=o instanceof t.FixedPoint?o:new t.FixedPoint(o)}return i.zero=function(){return new i},i.prototype.add=function(o){return new i(t.FixedPoint.add(this.x,o.x),t.FixedPoint.add(this.y,o.y))},i.prototype.sub=function(o){return new i(t.FixedPoint.sub(this.x,o.x),t.FixedPoint.sub(this.y,o.y))},i.prototype.mul=function(o){return new i(t.FixedPoint.mul(this.x,o),t.FixedPoint.mul(this.y,o))},i.prototype.div=function(o){return new i(t.FixedPoint.div(this.x,o),t.FixedPoint.div(this.y,o))},i.prototype.isZero=function(){return 0==this.x.toFloat()&&0==this.y.toFloat()},i.prototype.set=function(t,i){return this.x=t,this.y=i,this},i.prototype.setR=function(t){return this.x=t.x,this.y=t.y,this},i.prototype.length=function(){var i=t.FixedPoint.add(t.FixedPoint.mul(this.x,this.x),t.FixedPoint.mul(this.y,this.y));return t.FixedPoint.from(Math.sqrt(i.toFloat()))},i.prototype.lengthSquared=function(){return t.FixedPoint.add(t.FixedPoint.mul(this.x,this.x),t.FixedPoint.mul(this.y,this.y))},i.prototype.normalize=function(){var o=this.length();return new i(t.FixedPoint.div(this.x,o),t.FixedPoint.div(this.y,o))},i.prototype.dot=function(i){return t.FixedPoint.add(t.FixedPoint.mul(this.x,i.x),t.FixedPoint.mul(this.y,i.y))},i.prototype.cross=function(i){return t.FixedPoint.sub(t.FixedPoint.mul(this.x,i.y),t.FixedPoint.mul(this.y,i.x))},i.prototype.crossR=function(i){return t.FixedPoint.sub(this.x.mul(i),this.y.mul(i))},i.prototype.distanceTo=function(i){var o=t.FixedPoint.sub(this.x,i.x),n=t.FixedPoint.sub(this.y,i.y),e=t.FixedPoint.add(t.FixedPoint.mul(o,o),t.FixedPoint.mul(n,n));return t.FixedPoint.from(Math.sqrt(e.toFloat()))},i.prototype.perp=function(){return new i(this.y.negate(),this.x)},i.prototype.perpR=function(){return new i(this.y,this.x.negate())},i.prototype.lengthSq=function(){return this.x.mul(this.x).add(this.y.mul(this.y))},i.prototype.negate=function(){return new i(this.x.negate(),this.y.negate())},i.negate=function(t){return t.x=t.x.negate(),t.y=t.y.negate(),t},i}();t.Vector2=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){void 0===i&&(i=new t.FixedPoint(0,-9.81)),void 0===o&&(o=new t.FixedPoint(1/60)),this.name="PhysicsPlugin",this.gravity=i,this.timeStep=o}return i.prototype.onInit=function(i){i.systemManager.registerSystem(new t.CollisionResponseSystem(i.entityManager,1e3*this.timeStep.toFloat()))},i.prototype.onUpdate=function(t){},i}();t.World=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.dependencies=[i.Transform],o.collidingEntities=new Set,o.onCollisionEnter=function(){},o.onCollisionStay=function(){},o.onCollisionExit=function(){},o}return __extends(o,t),Object.defineProperty(o.prototype,"transform",{get:function(){return null==this._transform&&(this._transform=this.entity.getComponent(i.Transform)),this._transform},enumerable:!0,configurable:!0}),o.prototype.getBounds=function(){return this._bounds.position=this.transform.position,this._bounds},o.prototype.setBounds=function(t){this._bounds=t},o.prototype.handleCollision=function(t){this.collidingEntities.has(t)?this.onCollisionStay(t):(this.collidingEntities.add(t),this.onCollisionEnter(t))},o.prototype.handleCollisionExit=function(t){this.collidingEntities.has(t)&&(this.collidingEntities.delete(t),this.onCollisionExit(t))},o.prototype.getCollisionNormal=function(t){var o=this.getBounds(),n=t.getBounds(),e=o.position.add(new i.Vector2(new i.FixedPoint(o.width.toFloat()/2),new i.FixedPoint(o.height.toFloat()/2))),r=n.position.add(new i.Vector2(new i.FixedPoint(n.width.toFloat()/2),new i.FixedPoint(n.height.toFloat()/2))).sub(e);return Math.abs(r.x.toFloat())>Math.abs(r.y.toFloat())?new i.Vector2(new i.FixedPoint(r.x.toFloat()>0?1:-1),new i.FixedPoint(0)):new i.Vector2(new i.FixedPoint(0),new i.FixedPoint(r.y.toFloat()>0?1:-1))},o.prototype.intersects=function(t){return this.getBounds().intersects(t.getBounds())},o.prototype.contains=function(t){return this.getBounds().contains(t.getBounds())},o}(t.Component);i.Collider=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(i){function o(){return null!==i&&i.apply(this,arguments)||this}return __extends(o,i),o.prototype.onInitialize=function(i){this.size=i;var o=new t.BoxBounds(this.transform.position,this.size.width,this.size.height,this.entity);this.setBounds(o)},o}(t.Collider);t.BoxCollider=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(i){function o(){return null!==i&&i.apply(this,arguments)||this}return __extends(o,i),o.prototype.onInitialize=function(i){this.radius=i;var o=new t.CircleBounds(this.transform.position,this.radius,this.entity);this.setBounds(o)},o}(t.Collider);t.CircleCollider=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(t.Collider);t.PolygonCollider=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(t,i,o,n){this.position=t,this.width=i,this.height=o,this.entity=n}return i.prototype.project=function(i){var o,n,e=[this.position,this.position.add(new t.Vector2(this.width.toFloat(),0)),this.position.add(new t.Vector2(this.width.toFloat(),this.height.toFloat())),this.position.add(new t.Vector2(0,this.height.toFloat()))],r=1/0,s=-1/0;try{for(var a=__values(e),l=a.next();!l.done;l=a.next()){var h=l.value.dot(i).toFloat();r=Math.min(r,h),s=Math.max(s,h)}}catch(t){o={error:t}}finally{try{l&&!l.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return new t.Projection(r,s)},i.prototype.intersects=function(i){var o=new t.IntersectionVisitor(i);return this.accept(o),o.getResult()},i.prototype.contains=function(i){var o=new t.ContainVisitor(i);return this.accept(o),o.getResult()},i.prototype.accept=function(t){t.visitBox(this)},i}();t.BoxBounds=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(t,i,o){this.position=t,this.radius=i,this.entity=o,this.width=i.mul(2),this.height=i.mul(2)}return i.prototype.intersects=function(i){var o=new t.IntersectionVisitor(i);return this.accept(o),o.getResult()},i.prototype.contains=function(i){var o=new t.ContainVisitor(i);return this.accept(o),o.getResult()},i.prototype.accept=function(t){t.visitCircle(this)},i}();t.CircleBounds=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(t){this.other=t,this.result=!1}return i.prototype.visitBox=function(i){if(this.other instanceof t.BoxBounds){var o=this.other;this.result=i.position.x.toFloat()<=o.position.x.toFloat()&&i.position.y.toFloat()<=o.position.y.toFloat()&&i.position.x.toFloat()+i.width.toFloat()>=o.position.x.toFloat()+o.width.toFloat()&&i.position.y.toFloat()+i.height.toFloat()>=o.position.y.toFloat()+o.height.toFloat()}else if(this.other instanceof t.CircleBounds){var n=this.other,e=new t.BoxBounds(n.position,n.radius.mul(2),n.radius.mul(2),n.entity);this.result=i.position.x.toFloat()<=e.position.x.toFloat()&&i.position.y.toFloat()<=e.position.y.toFloat()&&i.position.x.toFloat()+i.width.toFloat()>=e.position.x.toFloat()+e.width.toFloat()&&i.position.y.toFloat()+i.height.toFloat()>=e.position.y.toFloat()+e.height.toFloat()}},i.prototype.visitCircle=function(i){if(this.other instanceof t.CircleBounds){var o=this.other,n=i.position.x.toFloat()-o.position.x.toFloat(),e=i.position.y.toFloat()-o.position.y.toFloat(),r=Math.sqrt(n*n+e*e);this.result=r+o.radius.toFloat()<=i.radius.toFloat()}else if(this.other instanceof t.BoxBounds){var s=this.other,a=Math.sqrt(Math.pow(s.width.toFloat()/2,2)+Math.pow(s.height.toFloat()/2,2)),l=new t.CircleBounds(s.position.add(new t.Vector2(s.width.div(2),s.height.div(2))),new t.FixedPoint(a),s.entity);n=i.position.x.toFloat()-l.position.x.toFloat(),e=i.position.y.toFloat()-l.position.y.toFloat(),r=Math.sqrt(n*n+e*e);this.result=r+l.radius.toFloat()<=i.radius.toFloat()}},i.prototype.visitPolygon=function(i){if(this.other instanceof t.PolygonBounds){var o=this.other;this.result=o.vertices.every(function(t){return i.containsPoint(t)})}},i.prototype.getResult=function(){return this.result},i}();t.ContainVisitor=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(t){this.other=t,this.result=!1}return i.prototype.visitBox=function(i){if(this.other instanceof t.BoxBounds){var o=this.other;this.result=!(i.position.x.add(i.width).lt(o.position.x)||o.position.x.add(o.width).lt(i.position.x)||i.position.y.add(i.height).lt(o.position.y)||o.position.y.add(o.height).lt(i.position.y))}else this.other instanceof t.CircleBounds?this.result=this.intersectsBoxCircle(i,this.other):this.other instanceof t.PolygonBounds&&(this.result=this.intersectsPolygonBox(this.other,i))},i.prototype.visitCircle=function(i){if(this.other instanceof t.CircleBounds){var o=this.other,n=i.position.x.toFloat()-o.position.x.toFloat(),e=i.position.y.toFloat()-o.position.y.toFloat(),r=Math.sqrt(n*n+e*e);this.result=r<i.radius.toFloat()+o.radius.toFloat()}else this.other instanceof t.BoxBounds?this.result=this.intersectsBoxCircle(this.other,i):this.other instanceof t.PolygonBounds&&(this.result=this.intersectsPolygonCircle(this.other,i))},i.prototype.visitPolygon=function(i){if(this.other instanceof t.PolygonBounds){var o=this.other,n=new t.CollisionDetector(i,o);this.result=n.gjk()}else this.other instanceof t.CircleBounds?this.result=this.intersectsPolygonCircle(i,this.other):this.other instanceof t.BoxBounds&&(this.result=this.intersectsPolygonBox(i,this.other))},i.prototype.intersectsBoxCircle=function(t,i){var o=i.position.x.sub(t.position.x.add(t.width.div(2))).abs(),n=i.position.y.sub(t.position.y.add(t.height.div(2))).abs();return!o.gt(t.width.div(2).add(i.radius))&&(!n.gt(t.height.div(2).add(i.radius))&&(!!o.lte(t.width.div(2))||(!!n.lte(t.height.div(2))||o.sub(t.width.div(2)).pow(2).add(n.sub(t.height.div(2)).pow(2)).lte(i.radius.pow(2)))))},i.prototype.intersectsPolygonCircle=function(t,i){var o,n,e=1/0,r=null;try{for(var s=__values(t.vertices),a=s.next();!a.done;a=s.next()){var l=a.value,h=l.sub(i.position).lengthSq().toFloat();h<e&&(e=h,r=l)}}catch(t){o={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return!!r&&r.sub(i.position).lengthSq().toFloat()<=Math.pow(i.radius.toFloat(),2)},i.prototype.intersectsPolygonBox=function(i,o){for(var n,e,r=[new t.Vector2(1,0),new t.Vector2(0,1),new t.Vector2(-1,0),new t.Vector2(0,-1)],s=0;s<i.vertices.length;s++){var a=i.vertices[s],l=i.vertices[(s+1)%i.vertices.length].sub(a);r.push(l.normalize().perp())}try{for(var h=__values(r),u=h.next();!u.done;u=h.next()){var c=u.value,d=i.project(c),p=o.project(c);if(!d.overlaps(p))return!1}}catch(t){n={error:t}}finally{try{u&&!u.done&&(e=h.return)&&e.call(h)}finally{if(n)throw n.error}}return!0},i.prototype.getResult=function(){return this.result},i}();t.IntersectionVisitor=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(){}return Object.defineProperty(i.prototype,"vertices",{get:function(){return this._vertices},enumerable:!0,configurable:!0}),i.prototype.getFarthestPointInDirection=function(t){var i,o,n=-1/0,e=null;try{for(var r=__values(this._vertices),s=r.next();!s.done;s=r.next()){var a=s.value,l=a.dot(t).toFloat();l>n&&(n=l,e=a)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}return e},i.prototype.project=function(i){var o,n,e=1/0,r=-1/0;try{for(var s=__values(this._vertices),a=s.next();!a.done;a=s.next()){var l=a.value.dot(i).toFloat();e=Math.min(e,l),r=Math.max(r,l)}}catch(t){o={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(o)throw o.error}}return new t.Projection(e,r)},i.prototype.containsPoint=function(t){for(var i=!1,o=t.x.toFloat(),n=t.y.toFloat(),e=0,r=this._vertices.length-1;e<this._vertices.length;r=e++){var s=this._vertices[e].x.toFloat(),a=this._vertices[e].y.toFloat(),l=this._vertices[r].x.toFloat(),h=this._vertices[r].y.toFloat();a>n!=h>n&&o<(l-s)*(n-a)/(h-a)+s&&(i=!i)}return i},i.prototype.intersects=function(i){var o=new t.IntersectionVisitor(i);return this.accept(o),o.getResult()},i.prototype.contains=function(i){var o=new t.ContainVisitor(i);return this.accept(o),o.getResult()},i.prototype.accept=function(t){t.visitPolygon(this)},i}();t.PolygonBounds=i}(t.physics||(t.physics={}))}(gs||(gs={}));