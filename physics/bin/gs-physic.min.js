window.gs.physics={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o])};return function(i,o){function e(){this.constructor=i}t(i,o),i.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}}();var gs,__values=this&&this.__values||function(t){var i="function"==typeof Symbol&&t[Symbol.iterator],o=0;return i?i.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}},__read=this&&this.__read||function(t,i){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var e,n,s=o.call(t),r=[];try{for(;(void 0===i||i-- >0)&&!(e=s.next()).done;)r.push(e.value)}catch(t){n={error:t}}finally{try{e&&!e.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}return r},__spread=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(__read(arguments[i]));return t};!function(t){!function(i){var o=function(t){function o(i,o,e,n){var s=t.call(this,i)||this;return s.entity1=o,s.entity2=e,s.velocities=n,s}return __extends(o,t),o.prototype.reset=function(){t.prototype.reset.call(this),this.entity1=null,this.entity2=null,this.velocities={v1:new i.Vector2(0,0),v2:new i.Vector2(0,0)}},o.prototype.getEntity1=function(){return this.entity1},o.prototype.getEntity2=function(){return this.entity2},o.prototype.getVelocities=function(){return this.velocities},o}(t.Event);i.CollisionEvent=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(){function o(){t.GlobalEventEmitter.on("collision",this.handleCollision.bind(this))}return o.prototype.handleCollision=function(t){var o=t.data,e=o.entity1,n=o.entity2,s=o.velocities;e.getComponent(i.RigidBody).velocity=s.v1,n.getComponent(i.RigidBody).velocity=s.v2},o}();i.CollisionHandlerSystem=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(o){function e(e,n,s,r){var a=o.call(this,e,0,t.Matcher.empty().all(i.RigidBody,i.Collider))||this;return a.processed=new Map,a.candidates=new Set,a.quadTree=new i.QuadTree(0,{position:n,width:s,height:r}),a}return __extends(e,o),e.prototype.update=function(t){var o,e,n,s,r,a,h=this.quadTree,l=(this.processed,this.candidates);try{for(var u=__values(t),d=u.next();!d.done;d=u.next()){var c=(x=d.value).getComponent(i.Collider);c&&(h.insert(c.getBounds()),c.isColliding=!1);var p=x.getId(),y=this.processed.get(p);y?y.clear():this.processed.set(p,new Set),this.processed.get(p).add(p)}}catch(t){o={error:t}}finally{try{d&&!d.done&&(e=u.return)&&e.call(u)}finally{if(o)throw o.error}}try{for(var f=__values(t),v=f.next();!v.done;v=f.next()){var x,w=(x=v.value).getComponent(i.Collider);if(w){p=x.getId();var g=w.getBounds();l.clear(),h.retrieve(l,g);try{for(var F=__values(l),P=F.next();!P.done;P=F.next()){var m=P.value,_=m.entity.getId();if(p!==_&&(!this.processed.has(p)||!this.processed.get(p).has(_))){var V=m.entity.getComponent(i.Collider),b=V.getBounds();this.isColliding(g,b)&&(w.isColliding=!0,V.isColliding=!0),this.processed.has(p)||this.processed.set(p,new Set),this.processed.get(p).add(_)}}}catch(t){r={error:t}}finally{try{P&&!P.done&&(a=F.return)&&a.call(F)}finally{if(r)throw r.error}}}}}catch(t){n={error:t}}finally{try{v&&!v.done&&(s=f.return)&&s.call(f)}finally{if(n)throw n.error}}h.clear()},e.prototype.calculateVelocityAfterCollision=function(t,o){var e=i.FixedPoint.add(t.mass,o.mass),n=i.FixedPoint.sub(t.mass,o.mass),s=i.FixedPoint.sub(o.mass,t.mass),r=i.FixedPoint.mul(t.mass,2),a=i.FixedPoint.mul(o.mass,2);return{v1:t.velocity.multiplyScalar(n.toFloat()).divideScalar(e.toFloat()).add(o.velocity.multiplyScalar(a.toFloat()).divideScalar(e.toFloat())),v2:t.velocity.multiplyScalar(r.toFloat()).divideScalar(e.toFloat()).subtract(o.velocity.multiplyScalar(s.toFloat()).divideScalar(e.toFloat()))}},e.prototype.isColliding=function(t,o){var e=t.position,n=t.width,s=t.height,r=o.position,a=o.width,h=o.height;return!(r.x.gt(i.FixedPoint.add(e.x,n))||i.FixedPoint.add(r.x,a).lt(e.x)||r.y.gt(i.FixedPoint.add(e.y,s))||i.FixedPoint.add(r.y,h).lt(e.y))},e}(t.System);i.CollisionResponseSystem=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=1e3),this.rawValue=Math.round(t*i),this.precision=i}return t.prototype.add=function(i){return this.rawValue+=i instanceof t?i.rawValue:Math.round(i*this.precision),this},t.prototype.sub=function(i){return this.rawValue-=i instanceof t?i.rawValue:Math.round(i*this.precision),this},t.prototype.mul=function(i){return this.rawValue=i instanceof t?Math.round(this.rawValue*i.rawValue/i.precision):Math.round(this.rawValue*i),this},t.prototype.div=function(i){return this.rawValue=i instanceof t?Math.round(this.rawValue/i.rawValue*this.precision):Math.round(this.rawValue/i),this},t.prototype.lt=function(i){return i instanceof t?this.rawValue<i.rawValue:this.rawValue<Math.round(i*this.precision)},t.prototype.gt=function(i){return i instanceof t?this.rawValue>i.rawValue:this.rawValue>Math.round(i*this.precision)},t.prototype.gte=function(i){return i instanceof t?this.rawValue>=i.rawValue:this.rawValue>=Math.round(i*this.precision)},t.prototype.lte=function(i){return i instanceof t?this.rawValue<=i.rawValue:this.rawValue<=Math.round(i*this.precision)},t.prototype.neg=function(){var i=new t;return i.rawValue=-this.rawValue,i},t.prototype.toFloat=function(){return this.rawValue/this.precision},t.add=function(i,o){var e=new t;return e.rawValue=o instanceof t?i.rawValue+o.rawValue:i.rawValue+Math.round(o*i.precision),e},t.sub=function(i,o){var e=new t;return e.rawValue=o instanceof t?i.rawValue-o.rawValue:i.rawValue-Math.round(o*i.precision),e},t.mul=function(i,o){var e=new t;return e.rawValue=o instanceof t?Math.round(i.rawValue*o.rawValue/o.precision):Math.round(i.rawValue*o),e},t.div=function(i,o){var e=new t;return e.rawValue=o instanceof t?Math.round(i.rawValue/o.rawValue*i.precision):Math.round(i.rawValue/o),e},t.max=function(t,i){return t.gt(i)?t:i},t.min=function(t,i){return t.lt(i)?t:i},t}();t.FixedPoint=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o,e){void 0===e&&(e=100),this.cellSize=e,this.level=i,this.bounds=o,this.spatialHash=new t.SpatialHash(e),this.nodes=[]}return i.prototype.split=function(){var o,e,n=t.FixedPoint.div(this.bounds.width,2),s=t.FixedPoint.div(this.bounds.height,2),r=this.bounds.position.x,a=this.bounds.position.y,h=new t.Vector2(r.toFloat(),a.toFloat()),l=new t.Vector2(t.FixedPoint.add(r,n).toFloat(),a.toFloat()),u=new t.Vector2(r.toFloat(),t.FixedPoint.add(a,s).toFloat()),d=new t.Vector2(t.FixedPoint.add(r,n).toFloat(),t.FixedPoint.add(a,s).toFloat());this.nodes[0]=new i(this.level+1,{position:l,width:n,height:s},this.cellSize),this.nodes[1]=new i(this.level+1,{position:h,width:n,height:s},this.cellSize),this.nodes[2]=new i(this.level+1,{position:d,width:n,height:s},this.cellSize),this.nodes[3]=new i(this.level+1,{position:u,width:n,height:s},this.cellSize);var c=this.spatialHash.retrieveAll();this.spatialHash.clear();try{for(var p=__values(c),y=p.next();!y.done;y=p.next()){var f=y.value;this.insert(f)}}catch(t){o={error:t}}finally{try{y&&!y.done&&(e=p.return)&&e.call(p)}finally{if(o)throw o.error}}},i.prototype.insert=function(t){var i,o;if(this.nodes[0]){var e=this.getIndexes(t);try{for(var n=__values(e),s=n.next();!s.done;s=n.next()){var r=s.value;this.nodes[r].insert(t)}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}}this.spatialHash.retrieve(t).length>50&&this.level<10&&!this.nodes[0]&&this.split(),this.spatialHash.insert(t)},i.prototype.getIndex=function(i){var o=-1,e=t.FixedPoint.add(this.bounds.position.x,t.FixedPoint.div(this.bounds.width,2)),n=t.FixedPoint.add(this.bounds.position.y,t.FixedPoint.div(this.bounds.height,2)),s=i.position.y.lt(n)&&t.FixedPoint.add(i.position.y,i.height).lt(n),r=i.position.y.gt(n);return i.position.x.lt(e)&&t.FixedPoint.add(i.position.x,i.width).lt(e)?s?o=1:r&&(o=2):i.position.x.gt(e)&&(s?o=0:r&&(o=3)),o},i.prototype.getIndexes=function(i){var o=[],e=t.FixedPoint.add(this.bounds.position.x,t.FixedPoint.div(this.bounds.width,2)),n=t.FixedPoint.add(this.bounds.position.y,t.FixedPoint.div(this.bounds.height,2)),s=t.FixedPoint.add(i.position.x,i.width),r=t.FixedPoint.add(i.position.y,i.height),a=i.position.y.lt(n)&&r.lt(n),h=i.position.y.gt(n);return i.position.x.lt(e)&&s.lt(e)?(a&&o.push(1),h&&o.push(2)):i.position.x.gt(e)&&(a&&o.push(0),h&&o.push(3)),o},i.prototype.retrieve=function(t,i){var o,e,n,s;if(!this.boundsIntersects(i))return t;var r=this.spatialHash.retrieve(i);try{for(var a=__values(r),h=a.next();!h.done;h=a.next()){var l=h.value;this.collidesWith(l,i)&&t.add(l)}}catch(t){o={error:t}}finally{try{h&&!h.done&&(e=a.return)&&e.call(a)}finally{if(o)throw o.error}}if(this.nodes[0])try{for(var u=__values(this.nodes),d=u.next();!d.done;d=u.next()){d.value.retrieve(t,i)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}return t},i.prototype.collidesWith=function(i,o){var e=t.FixedPoint.add(i.position.x,i.width),n=t.FixedPoint.add(i.position.y,i.height),s=t.FixedPoint.add(o.position.x,o.width),r=t.FixedPoint.add(o.position.y,o.height);return!(e.lt(o.position.x)||n.lt(o.position.y)||i.position.x.gt(s)||i.position.y.gt(r))},i.prototype.retrieveAll=function(){var t=this.spatialHash.retrieveAll();if(null!=this.nodes[0])for(var i=0;i<this.nodes.length;i++)null!=this.nodes[i]&&(t=t.concat(this.nodes[i].retrieveAll()));return t},i.prototype.boundsIntersects=function(i){var o=t.FixedPoint.add(i.position.x,i.width),e=t.FixedPoint.add(i.position.y,i.height),n=t.FixedPoint.add(this.bounds.position.x,this.bounds.width),s=t.FixedPoint.add(this.bounds.position.y,this.bounds.height);return!(o.lt(this.bounds.position.x)||e.lt(this.bounds.position.y)||i.position.x.gt(n)||i.position.y.gt(s))},i.prototype.clear=function(){this.spatialHash.clear();for(var t=0;t<this.nodes.length;t++)null!=this.nodes[t]&&(this.nodes[t].clear(),this.nodes[t]=null)},i}();t.QuadTree=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.position=new i.Vector2,o.velocity=new i.Vector2,o.mass=new i.FixedPoint,o.size=new i.Vector2,o}return __extends(o,t),o}(t.Component);i.RigidBody=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.width=new t.FixedPoint(i),this.height=new t.FixedPoint(o)}return i.prototype.add=function(t){return new i(this.width.toFloat()+t.width.toFloat(),this.height.toFloat()+t.height.toFloat())},i.prototype.subtract=function(t){return new i(this.width.toFloat()-t.width.toFloat(),this.height.toFloat()-t.height.toFloat())},i.prototype.multiply=function(t){return new i(this.width.toFloat()*t,this.height.toFloat()*t)},i.prototype.divide=function(t){return new i(this.width.toFloat()/t,this.height.toFloat()/t)},i}();t.Size=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t){this.cellSize=t,this.hashTable=new Map}return t.prototype.hash=function(t,i){var o=Math.floor(t/this.cellSize);return Math.floor(i/this.cellSize)+","+o},t.prototype.insert=function(t){for(var i=Math.floor(t.position.x.toFloat()/this.cellSize),o=Math.floor(t.position.y.toFloat()/this.cellSize),e=Math.floor((t.position.x.toFloat()+t.width.toFloat())/this.cellSize),n=Math.floor((t.position.y.toFloat()+t.height.toFloat())/this.cellSize),s=i;s<=e;s++)for(var r=o;r<=n;r++){var a=this.hash(s,r),h=this.hashTable.get(a);void 0===h&&(h=[],this.hashTable.set(a,h)),h.push(t)}},t.prototype.retrieve=function(t){for(var i=Math.floor(t.position.x.toFloat()/this.cellSize),o=Math.floor(t.position.y.toFloat()/this.cellSize),e=Math.floor((t.position.x.toFloat()+t.width.toFloat())/this.cellSize),n=Math.floor((t.position.y.toFloat()+t.height.toFloat())/this.cellSize),s=[],r=i;r<=e;r++)for(var a=o;a<=n;a++){var h=this.hash(r,a),l=this.hashTable.get(h);void 0!==l&&s.push.apply(s,__spread(l))}return s},t.prototype.retrieveAll=function(){var t,i,o=[];try{for(var e=__values(this.hashTable.values()),n=e.next();!n.done;n=e.next()){var s=n.value;o.push.apply(o,__spread(s))}}catch(i){t={error:i}}finally{try{n&&!n.done&&(i=e.return)&&i.call(e)}finally{if(t)throw t.error}}return o},t.prototype.remove=function(t){for(var i=Math.floor(t.position.x.toFloat()/this.cellSize),o=Math.floor(t.position.y.toFloat()/this.cellSize),e=Math.floor((t.position.x.toFloat()+t.width.toFloat())/this.cellSize),n=Math.floor((t.position.y.toFloat()+t.height.toFloat())/this.cellSize),s=i;s<=e;s++)for(var r=o;r<=n;r++){var a=this.hash(s,r),h=this.hashTable.get(a);if(void 0!==h){var l=h.indexOf(t);-1!==l&&h.splice(l,1)}}},t.prototype.clear=function(){this.hashTable.clear()},t}();t.SpatialHash=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.onInitialize=function(t,o){void 0===t&&(t=0),void 0===o&&(o=0),this.position=new i.Vector2(t,o)},o}(t.Component);i.Transform=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.x=i instanceof t.FixedPoint?i:new t.FixedPoint(i),this.y=o instanceof t.FixedPoint?o:new t.FixedPoint(o)}return i.prototype.add=function(t){return new i(this.x.toFloat()+t.x.toFloat(),this.y.toFloat()+t.y.toFloat())},i.prototype.subtract=function(t){return new i(this.x.toFloat()-t.x.toFloat(),this.y.toFloat()-t.y.toFloat())},i.prototype.multiply=function(t){return new i(this.x.toFloat()*t,this.y.toFloat()*t)},i.prototype.divide=function(t){return new i(this.x.toFloat()/t,this.y.toFloat()/t)},i.prototype.multiplyScalar=function(t){return new i(this.x.toFloat()*t,this.y.toFloat()*t)},i.prototype.divideScalar=function(t){return new i(this.x.toFloat()/t,this.y.toFloat()/t)},i.prototype.length=function(){return new t.FixedPoint(Math.sqrt(this.x.toFloat()*this.x.toFloat()+this.y.toFloat()*this.y.toFloat()))},i.prototype.lengthSquared=function(){return new t.FixedPoint(this.x.toFloat()*this.x.toFloat()+this.y.toFloat()*this.y.toFloat())},i.prototype.normalize=function(){var t=this.length();return new i(this.x.div(t),this.y.div(t))},i.prototype.dot=function(i){return new t.FixedPoint(this.x.toFloat()*i.x.toFloat()+this.y.toFloat()*i.y.toFloat())},i.prototype.cross=function(i){return new t.FixedPoint(this.x.toFloat()*i.y.toFloat()-this.y.toFloat()*i.x.toFloat())},i.prototype.distanceTo=function(i){var o=this.x.sub(i.x),e=this.y.sub(i.y);return new t.FixedPoint(Math.sqrt(o.toFloat()*o.toFloat()+e.toFloat()*e.toFloat()))},i}();t.Vector2=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o,e,n){void 0===i&&(i=new t.FixedPoint(0,-9.81)),void 0===o&&(o=new t.FixedPoint(1,60)),void 0===e&&(e=new t.Vector2),void 0===n&&(n=new t.Size(1e3,1e3)),this.name="PhysicsPlugin",this.gravity=i,this.timeStep=o,this.bodies=[],this.initialPos=e,this.size=n}return i.prototype.onInit=function(i){i.systemManager.registerSystem(new t.CollisionResponseSystem(i.entityManager,this.initialPos,this.size.width,this.size.height))},i.prototype.onUpdate=function(t){this.step()},i.prototype.addBody=function(t){this.bodies.push(t)},i.prototype.updateSize=function(){var i,o;try{for(var e=__values(this.bodies),n=e.next();!n.done;n=e.next()){var s=n.value;this.size.width=t.FixedPoint.max(this.size.width,t.FixedPoint.add(s.position.x,s.size.x)),this.size.height=t.FixedPoint.max(this.size.height,t.FixedPoint.add(s.position.y,s.size.y))}}catch(t){i={error:t}}finally{try{n&&!n.done&&(o=e.return)&&o.call(e)}finally{if(i)throw i.error}}},i.prototype.handleBorderCollision=function(i){(i.position.x.lt(0)||t.FixedPoint.add(i.position.x,i.size.x).gt(this.size.width))&&(i.velocity.x=i.velocity.x.neg()),(i.position.y.lt(0)||t.FixedPoint.add(i.position.y,i.size.y).gt(this.size.height))&&(i.velocity.y=i.velocity.y.neg())},i.prototype.step=function(){},i}();t.World=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.getBounds=function(){return{position:new i.Vector2,width:new i.FixedPoint,height:new i.FixedPoint,entity:this.entity}},o}(t.Component);i.Collider=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(i){function o(){var o=null!==i&&i.apply(this,arguments)||this;return o.dependencies=[t.Transform],o}return __extends(o,i),o.prototype.onInitialize=function(i){this.size=i,this.transform=this.entity.getComponent(t.Transform)},o.prototype.getBounds=function(){return{position:this.transform.position,width:this.size.width,height:this.size.height,entity:this.entity}},o}(t.Collider);t.BoxCollider=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(){}return Object.defineProperty(t.prototype,"width",{get:function(){return this.radius.mul(2)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.radius.mul(2)},enumerable:!0,configurable:!0}),t.prototype.area=function(){return this.radius.mul(this.radius).mul(Math.PI)},t.prototype.circumference=function(){return this.radius.mul(2).mul(Math.PI)},t.prototype.containsPoint=function(t){return this.position.distanceTo(t).lte(this.radius)},t.prototype.intersects=function(t){return this.position.distanceTo(t.position).lte(this.radius.add(t.radius))},t}();t.Circle=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(){}return t.prototype.area=function(){return this.width.mul(this.height)},t.prototype.containsPoint=function(t){return t.x.gte(this.position.x)&&t.x.lte(this.position.x.add(this.width))&&t.y.gte(this.position.y)&&t.y.lte(this.position.y.add(this.height))},t.prototype.intersects=function(t){return!(t.position.x.add(t.width).lt(this.position.x)||t.position.y.add(t.height).lt(this.position.y)||t.position.x.gt(this.position.x.add(this.width))||t.position.y.gt(this.position.y.add(this.height)))},t}();t.Rectangle=i}(t.physics||(t.physics={}))}(gs||(gs={}));