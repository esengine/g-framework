window.gs.physics={};var __values=this&&this.__values||function(t){var o="function"==typeof Symbol&&t[Symbol.iterator],i=0;return o?o.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}};window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var i in o)o.hasOwnProperty(i)&&(t[i]=o[i])};return function(o,i){function n(){this.constructor=o}t(o,i),o.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();var gs,__read=this&&this.__read||function(t,o){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,e,r=i.call(t),s=[];try{for(;(void 0===o||o-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}return s},__spread=this&&this.__spread||function(){for(var t=[],o=0;o<arguments.length;o++)t=t.concat(__read(arguments[o]));return t};!function(t){!function(t){var o=function(){function o(t,o){this.shape1=t,this.shape2=o}return o.prototype.epa=function(){for(var o,i,n=[];;){var e=n[0];try{for(var r=__values(n),s=r.next();!s.done;s=r.next()){var a=s.value;a.distance.lt(e.distance)&&(e=a)}}catch(t){o={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}var h=e.pointB.sub(e.pointA).perp(),l=this.support(h);if(l.sub(e.pointA).dot(h).lte(0)||l.distanceTo(t.Vector2.zero()).sub(e.distance).lte(0))return h.mul(e.distance);this.addPointToPolytope(n,l)}},o.prototype.gjk=function(){var o=new t.Vector2(1,0),i=new t.Simplex;for(i.add(this.support(o)),t.Vector2.negate(o);;){if(i.add(this.support(o)),i.vertices[0].dot(o).toFloat()<=0)return!1;if(this.updateSimplexAndDirection(i,o))return!0}},o.prototype.updateSimplexAndDirection=function(t,o){if(2===t.vertices.length){var i=t.vertices[1],n=(e=t.vertices[0]).negate();(s=i.sub(e)).cross(n).gt(0)?o.setR(s.perp().negate()):o.setR(s.perp())}else if(3===t.vertices.length){var e,r=t.vertices[2],s=(i=t.vertices[1],n=(e=t.vertices[0]).negate(),i.sub(e)),a=r.sub(e);s.cross(a);if(s.cross(n).gt(0))t.vertices.splice(2,1),o.setR(s.perp().negate());else{if(!a.cross(n).gt(0))return!0;t.vertices.splice(1,1),o.setR(a.perp())}}return!1},o.prototype.addPointToPolytope=function(o,i){for(var n,e,r,s,a=[],h=0;h<o.length;h++){var l=(f=o[h]).pointA,u=f.pointB.sub(l),c=i.sub(l);u.cross(c).gt(0)&&a.push(f)}try{for(var p=__values(a),d=p.next();!d.done;d=p.next()){var f=d.value,y=o.indexOf(f);-1!==y&&o.splice(y,1)}}catch(t){n={error:t}}finally{try{d&&!d.done&&(e=p.return)&&e.call(p)}finally{if(n)throw n.error}}try{for(var v=__values(a),g=v.next();!g.done;g=v.next()){f=g.value;o.push(new t.Edge(f.point1,i)),o.push(new t.Edge(i,f.point2))}}catch(t){r={error:t}}finally{try{g&&!g.done&&(s=v.return)&&s.call(v)}finally{if(r)throw r.error}}},o.prototype.support=function(t){var o=this.shape1.getFarthestPointInDirection(t),i=this.shape2.getFarthestPointInDirection(t.negate());return o.sub(i)},o}();t.CollisionDetector=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(t){function i(o,i,n,e){var r=t.call(this,o)||this;return r.entity1=i,r.entity2=n,r.velocities=e,r}return __extends(i,t),i.prototype.reset=function(){t.prototype.reset.call(this),this.entity1=null,this.entity2=null,this.velocities={v1:new o.Vector2(0,0),v2:new o.Vector2(0,0)}},i.prototype.getEntity1=function(){return this.entity1},i.prototype.getEntity2=function(){return this.entity2},i.prototype.getVelocities=function(){return this.velocities},i}(t.Event);o.CollisionEvent=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(){function i(){t.GlobalEventEmitter.on("collision",this.handleCollision.bind(this))}return i.prototype.handleCollision=function(t){var i=t.data,n=i.entity1,e=i.entity2,r=i.velocities;n.getComponent(o.RigidBody).velocity=r.v1,e.getComponent(o.RigidBody).velocity=r.v2},i}();o.CollisionHandlerSystem=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(i){function n(n,e){var r=i.call(this,n,0,t.Matcher.empty().all(o.RigidBody,o.Collider))||this;return r.processed=new Map,r.collisionPairs=[],r.dynamicTree=new o.DynamicTree,r.updateInterval=e,r}return __extends(n,i),n.prototype.update=function(t){var i,n,e,r,s,a,h,l,u=this.dynamicTree,c=this.processed,p=this.collisionPairs;u.clear(),c.clear(),p.length=0;var d=new Map,f=[];try{for(var y=__values(t),v=y.next();!v.done;v=y.next()){if(j=(R=v.value).getComponent(o.Collider)){var g={children:[],height:0,leaf:!0,bounds:j.getBounds()};f.push(g),d.set(g,R),j.isColliding=!1}}}catch(t){i={error:t}}finally{try{v&&!v.done&&(n=y.return)&&n.call(y)}finally{if(i)throw i.error}}u.load(f);try{for(var x=__values(f),w=x.next();!w.done;w=x.next()){g=w.value;var F=(R=d.get(g)).getId(),m=c.get(F);m||(m=new Set,c.set(F,m));var _=u.search(g.bounds);try{for(var b=__values(_),P=b.next();!P.done;P=b.next()){var M=P.value,B=d.get(M),V=B.getId();F===V||m.has(V)||(p.push([R,B]),m.add(V))}}catch(t){s={error:t}}finally{try{P&&!P.done&&(a=b.return)&&a.call(b)}finally{if(s)throw s.error}}}}catch(t){e={error:t}}finally{try{w&&!w.done&&(r=x.return)&&r.call(x)}finally{if(e)throw e.error}}try{for(var C=__values(p),S=C.next();!S.done;S=C.next()){var T=__read(S.value,2),R=T[0],j=(M=T[1],R.getComponent(o.Collider)),z=M.getComponent(o.Collider),I=R.getComponent(o.RigidBody),A=M.getComponent(o.RigidBody);j.isColliding=!0,z.isColliding=!0,I&&!I.isKinematic&&A&&!A.isKinematic&&(I.velocity=I.velocity.mul(new o.FixedPoint(-1)),A.velocity=A.velocity.mul(new o.FixedPoint(-1)))}}catch(t){h={error:t}}finally{try{S&&!S.done&&(l=C.return)&&l.call(C)}finally{if(h)throw h.error}}},n}(t.System);o.CollisionResponseSystem=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){function o(o,n,e,r,s){s||(s=i(null)),s.bounds=new t.BoxBounds(t.Vector2.zero(),new t.FixedPoint,new t.FixedPoint,null);for(var a=1/0,h=1/0,l=-1/0,u=-1/0,c=n;c<e;c++){var p=r(o.children[c]);a=Math.min(a,p.position.x.toFloat()),h=Math.min(h,p.position.y.toFloat()),l=Math.max(l,p.position.x.toFloat()+p.width.toFloat()),u=Math.max(u,p.position.y.toFloat()+p.height.toFloat())}var d=new t.BoxBounds(new t.Vector2(a,h),new t.FixedPoint(l-a),new t.FixedPoint(u-h),s.bounds.entity);return s.bounds=d,s}function i(o){return{children:o,height:1,leaf:!0,bounds:new t.BoxBounds(t.Vector2.zero(),new t.FixedPoint,new t.FixedPoint,null)}}function n(t,o,i,r,s){for(;r>i;){if(r-i>600){var a=r-i+1,h=o-i+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*Math.sign(h-a/2);n(t,o,Math.max(i,Math.floor(o-h*u/a+c)),Math.min(r,Math.floor(o+(a-h)*u/a+c)),s)}var p=t[o],d=i,f=r;for(e(t,i,o),s(t[r],p)>0&&e(t,i,r);d<f;){for(e(t,d,f),d++,f--;s(t[d],p)<0;)d++;for(;s(t[f],p)>0;)f--}0===s(t[i],p)?e(t,i,f):e(t,++f,r),f<=o&&(i=f+1),o<=f&&(r=f-1)}}function e(t,o,i){var n=t[o];t[o]=t[i],t[i]=n}t.findItem=function(t,o,i){if(!i)return o.indexOf(t);for(var n=0;n<o.length;n++)if(i(t,o[n]))return n;return-1},t.calcBounds=function(t,i){o(t,0,t.children.length,i,t)},t.distBounds=o,t.extend=function(o,i){var n=Math.min(o.position.x.toFloat(),i.position.x.toFloat()),e=Math.min(o.position.y.toFloat(),i.position.y.toFloat()),r=Math.max(o.position.x.toFloat()+o.width.toFloat(),i.position.x.toFloat()+i.width.toFloat()),s=Math.max(o.position.y.toFloat()+o.height.toFloat(),i.position.y.toFloat()+i.height.toFloat());return o.position.x=new t.FixedPoint(n),o.position.y=new t.FixedPoint(e),o.width=new t.FixedPoint(r-n),o.height=new t.FixedPoint(s-e),o},t.compareNodeMinX=function(t,o){return t.bounds.position.x.toFloat()-o.bounds.position.x.toFloat()},t.compareNodeMinY=function(t,o){return t.bounds.position.y.toFloat()-o.bounds.position.y.toFloat()},t.boundsArea=function(t){var o=t.bounds;return o.width.toFloat()*o.height.toFloat()},t.boundsMargin=function(t){var o=t.bounds;return o.width.toFloat()+o.height.toFloat()},t.enlargedArea=function(t,o){return(Math.max(o.position.x.toFloat()+o.width.toFloat(),t.position.x.toFloat()+t.width.toFloat())-Math.min(o.position.x.toFloat(),t.position.x.toFloat()))*(Math.max(o.position.y.toFloat()+o.height.toFloat(),t.position.y.toFloat()+t.height.toFloat())-Math.min(o.position.y.toFloat(),t.position.y.toFloat()))},t.intersectionArea=function(t,o){var i=Math.max(t.position.x.toFloat(),o.position.x.toFloat()),n=Math.max(t.position.y.toFloat(),o.position.y.toFloat()),e=Math.min(t.position.x.toFloat()+t.width.toFloat(),o.position.x.toFloat()+o.width.toFloat()),r=Math.min(t.position.y.toFloat()+t.height.toFloat(),o.position.y.toFloat()+o.height.toFloat());return Math.max(0,e-i)*Math.max(0,r-n)},t.createNode=i,t.multiSelect=function(t,o,i,e,r){for(var s=[o,i];s.length;)if(!((i=s.pop())-(o=s.pop())<=e)){var a=o+Math.ceil((i-o)/e/2)*e;n(t,a,o,i,r),s.push(o,a,a,i)}},t.quickselect=n,t.swap=e}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}return o.prototype.compareMinX=function(t,o){return t.bounds.position.x.toFloat()-o.bounds.position.x.toFloat()},o.prototype.compareMinY=function(t,o){return t.bounds.position.y.toFloat()-o.bounds.position.y.toFloat()},o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(t){var o=this.data,i=[];if(!t.intersects(o.bounds))return i;for(var n=[];o;){for(var e=0;e<o.children.length;e++){var r=o.children[e];t.intersects(r.bounds)&&(o.leaf?i.push(r):t.contains(r.bounds)?this._all(r,i):n.push(r))}o=n.pop()}return i},o.prototype.collides=function(t){var o=this.data;if(!t.intersects(o.bounds))return!1;for(var i=[];o;){for(var n=0;n<o.children.length;n++){var e=o.children[n];if(t.intersects(e.bounds)){if(o.leaf||t.contains(e.bounds))return!0;i.push(e)}}o=i.pop()}return!1},o.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var o=0;o<t.length;o++)this.insert(t[o]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var n=this.data;this.data=i,i=n}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},o.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},o.prototype.clear=function(){return this.data=t.createNode([]),this},o.prototype.remove=function(o,i){if(!o)return this;for(var n,e,r,s=this.data,a=(o.bounds,[]),h=[];s||a.length;){if(s||(s=a.pop(),e=a[a.length-1],n=h.pop(),r=!0),s.leaf){var l=t.findItem(o,s.children,i);if(-1!==l)return s.children.splice(l,1),a.push(s),this._condense(a),this}r||s.leaf||!o.bounds.contains(s.bounds)?e?(n++,s=e.children[n],r=!1):s=null:(a.push(s),h.push(n),n=0,e=s,s=s.children[0])}return this},o.prototype.toBounds=function(t){return t.bounds},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(t){return this.data=t,this},o.prototype._all=function(t,o){for(var i=[];t;)t.leaf?o.push.apply(o,__spread(t.children)):i.push.apply(i,__spread(t.children)),t=i.pop();return o},o.prototype._build=function(o,i,n,e){var r,s=n-i+1,a=this._maxEntries;if(s<=a)return r=t.createNode(o.slice(i,n+1)),t.calcBounds(r,this.toBounds),r;e||(e=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/Math.pow(a,e-1))),(r=t.createNode([])).leaf=!1,r.height=e;var h=Math.ceil(s/a),l=h*Math.ceil(Math.sqrt(a));t.multiSelect(o,i,n,l,this.compareMinX);for(var u=i;u<=n;u+=l){var c=Math.min(u+l-1,n);t.multiSelect(o,u,c,h,this.compareMinY);for(var p=u;p<=c;p+=h){var d=Math.min(p+h-1,c);r.children.push(this._build(o,p,d,e-1))}}return t.calcBounds(r,this.toBounds),r},o.prototype._chooseSubtree=function(o,i,n,e){for(;e.push(i),!i.leaf&&e.length-1!==n;){for(var r=1/0,s=1/0,a=void 0,h=0;h<i.children.length;h++){var l=i.children[h],u=t.boundsArea(l),c=t.enlargedArea(o,l.bounds)-u;c<s?(s=c,r=u<r?u:r,a=l):c===s&&u<r&&(r=u,a=l)}i=a||i.children[0]}return i},o.prototype._insert=function(o,i,n){var e=o.bounds,r=[],s=this._chooseSubtree(o.bounds,this.data,i,r);for(s.children.push(o),t.extend(s.bounds,e);i>=0&&r[i].children.length>this._maxEntries;)this._split(r,i),i--;this._adjustParentBounds(e,r,i)},o.prototype._split=function(o,i){var n=o[i],e=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,e);var s=this._chooseSplitIndex(n,r,e),a=t.createNode(n.children.splice(s,n.children.length-s));a.height=n.height,a.leaf=n.leaf,t.calcBounds(n,this.toBounds),t.calcBounds(a,this.toBounds),i?o[i-1].children.push(a):this._splitRoot(n,a)},o.prototype._splitRoot=function(o,i){this.data=t.createNode([o,i]),this.data.height=o.height+1,this.data.leaf=!1,t.calcBounds(this.data,this.toBounds)},o.prototype._chooseSplitIndex=function(o,i,n){for(var e,r=1/0,s=1/0,a=i;a<=n-i;a++){var h=t.distBounds(o,0,a,this.toBounds),l=t.distBounds(o,a,n,this.toBounds),u=t.intersectionArea(h.bounds,l.bounds),c=t.boundsArea(h)+t.boundsArea(l);u<r?(r=u,e=a,s=c<s?c:s):u===r&&c<s&&(s=c,e=a)}return e||n-i},o.prototype._chooseSplitAxis=function(o,i,n){var e=o.leaf?this.compareMinX:t.compareNodeMinX,r=o.leaf?this.compareMinY:t.compareNodeMinY;this._allDistMargin(o,i,n,e)<this._allDistMargin(o,i,n,r)&&o.children.sort(e)},o.prototype._allDistMargin=function(o,i,n,e){o.children.sort(e);for(var r=this.toBounds,s=t.distBounds(o,0,i,r),a=t.distBounds(o,n-i,n,r),h=t.boundsMargin(s)+t.boundsMargin(a),l=i;l<n-i;l++){var u=o.children[l];t.extend(s.bounds,o.leaf?r(u):u.bounds),h+=t.boundsMargin(s)}for(l=n-i-1;l>=i;l--){u=o.children[l];t.extend(a.bounds,o.leaf?r(u):u.bounds),h+=t.boundsMargin(a)}return h},o.prototype._adjustParentBounds=function(o,i,n){for(var e=n;e>=0;e--)t.extend(i[e].bounds,o)},o.prototype._condense=function(o){for(var i=o.length-1,n=void 0;i>=0;i--)0===o[i].children.length?i>0?(n=o[i-1].children).splice(n.indexOf(o[i]),1):this.clear():t.calcBounds(o[i],this.toBounds)},o}();t.DynamicTree=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){return function(t,o){this.pointA=t,this.pointB=o;var i=o.sub(t),n=t.negate();this.distance=i.cross(n).div(i.length())}}();t.Edge=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function t(t,o){void 0===t&&(t=0),void 0===o&&(o=1e3),this.rawValue=Math.round(t*o),this.precision=o}return t.prototype.add=function(o){var i=new t(0,this.precision);return i.rawValue=o instanceof t?this.rawValue+o.rawValue:this.rawValue+Math.round(o*this.precision),i},t.prototype.sub=function(o){var i=new t(0,this.precision);return i.rawValue=o instanceof t?this.rawValue-o.rawValue:this.rawValue-Math.round(o*this.precision),i},t.prototype.mul=function(o){var i=new t(0,this.precision);return i.rawValue=o instanceof t?Math.round(this.rawValue*o.rawValue/o.precision):Math.round(this.rawValue*o),i},t.prototype.div=function(o){var i=new t(0,this.precision);return i.rawValue=o instanceof t?Math.round(this.rawValue/o.rawValue*this.precision):Math.round(this.rawValue/o),i},t.prototype.abs=function(){var o=new t(0,this.precision);return o.rawValue=Math.abs(this.rawValue),o},t.prototype.pow=function(o){var i=Math.pow(this.toFloat(),o);return t.from(i)},t.prototype.lt=function(o){return o instanceof t?this.rawValue<o.rawValue:this.rawValue<Math.round(o*this.precision)},t.prototype.gt=function(o){return o instanceof t?this.rawValue>o.rawValue:this.rawValue>Math.round(o*this.precision)},t.prototype.gte=function(o){return o instanceof t?this.rawValue>=o.rawValue:this.rawValue>=Math.round(o*this.precision)},t.prototype.lte=function(o){return o instanceof t?this.rawValue<=o.rawValue:this.rawValue<=Math.round(o*this.precision)},t.prototype.neg=function(){var o=new t;return o.rawValue=-this.rawValue,o},t.prototype.toFloat=function(){return this.rawValue/this.precision},t.add=function(o,i){var n=new t;return n.rawValue=i instanceof t?o.rawValue+i.rawValue:o.rawValue+Math.round(i*o.precision),n},t.sub=function(o,i){var n=new t;return n.rawValue=i instanceof t?o.rawValue-i.rawValue:o.rawValue-Math.round(i*o.precision),n},t.mul=function(o,i){var n=new t;return n.rawValue=i instanceof t?Math.round(o.rawValue*i.rawValue/i.precision):Math.round(o.rawValue*i),n},t.div=function(o,i){var n=new t;return n.rawValue=i instanceof t?Math.round(o.rawValue/i.rawValue*o.precision):Math.round(o.rawValue/i),n},t.max=function(t,o){return t.gt(o)?t:o},t.min=function(t,o){return t.lt(o)?t:o},t.from=function(o){return new t("number"==typeof o?o:parseFloat(o))},t}();t.FixedPoint=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function t(t,o){this.min=t,this.max=o}return t.prototype.overlaps=function(t){return this.max>=t.min&&this.min<=t.max},t}();t.Projection=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.dependencies=[o.Transform],i}return __extends(i,t),i.prototype.onInitialize=function(t,i){void 0===t&&(t=new o.FixedPoint(1)),void 0===i&&(i=!1),this.mass=t,this.velocity=new o.Vector2(new o.FixedPoint(0),new o.FixedPoint(0)),this.acceleration=new o.Vector2(new o.FixedPoint(0),new o.FixedPoint(0)),this.isKinematic=i},i.prototype.applyForce=function(t){var i=new o.Vector2(t.x.div(this.mass),t.y.div(this.mass));this.acceleration=this.acceleration.add(i)},i.prototype.update=function(t){this.velocity=this.velocity.add(new o.Vector2(this.acceleration.x.mul(t),this.acceleration.y.mul(t)));var i=this.entity.getComponent(o.Transform).position;this.entity.getComponent(o.Transform).position=i.add(new o.Vector2(this.velocity.x.mul(t),this.velocity.y.mul(t))),this.acceleration.set(new o.FixedPoint(0),new o.FixedPoint(0))},i}(t.Component);o.RigidBody=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function t(){this.vertices=[]}return t.prototype.add=function(t){this.vertices.unshift(t)},t}();t.Simplex=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(o,i){void 0===o&&(o=0),void 0===i&&(i=0),this.width=new t.FixedPoint(o),this.height=new t.FixedPoint(i)}return o.prototype.add=function(t){return new o(this.width.toFloat()+t.width.toFloat(),this.height.toFloat()+t.height.toFloat())},o.prototype.subtract=function(t){return new o(this.width.toFloat()-t.width.toFloat(),this.height.toFloat()-t.height.toFloat())},o.prototype.multiply=function(t){return new o(this.width.toFloat()*t,this.height.toFloat()*t)},o.prototype.divide=function(t){return new o(this.width.toFloat()/t,this.height.toFloat()/t)},o}();t.Size=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function t(t){this.setPool=[],this.cellSize=t,this.hashTable=new Map,this.objectTable=new Map}return t.prototype.hash=function(t,o){return 73856093*t^19349663*o},t.prototype.getSetFromPool=function(){return this.setPool.length>0?this.setPool.pop():new Set},t.prototype.returnSetToPool=function(t){t.clear(),this.setPool.push(t)},t.prototype.insert=function(t){for(var o=Math.floor(t.position.x.toFloat()/this.cellSize),i=Math.floor(t.position.y.toFloat()/this.cellSize),n=Math.floor((t.position.x.toFloat()+t.width.toFloat())/this.cellSize),e=Math.floor((t.position.y.toFloat()+t.height.toFloat())/this.cellSize),r=[],s=o;s<=n;s++)for(var a=i;a<=e;a++){var h=this.hash(s,a);r.push(h);var l=this.hashTable.get(h);l||(l=this.getSetFromPool(),this.hashTable.set(h,l)),l.add(t)}this.objectTable.set(t,r)},t.prototype.retrieve=function(t,o){var i,n,e,r,s=this.objectTable.get(t);if(s)try{for(var a=__values(s),h=a.next();!h.done;h=a.next()){var l=h.value,u=this.hashTable.get(l);if(u)try{for(var c=__values(u),p=c.next();!p.done;p=c.next()){o(p.value)}}catch(t){e={error:t}}finally{try{p&&!p.done&&(r=c.return)&&r.call(c)}finally{if(e)throw e.error}}}}catch(t){i={error:t}}finally{try{h&&!h.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}},t.prototype.retrieveAll=function(){var t,o,i=[];try{for(var n=__values(this.hashTable.values()),e=n.next();!e.done;e=n.next()){var r=e.value;i.push.apply(i,__spread(r))}}catch(o){t={error:o}}finally{try{e&&!e.done&&(o=n.return)&&o.call(n)}finally{if(t)throw t.error}}return i},t.prototype.remove=function(t){var o,i,n=this.objectTable.get(t);if(n){try{for(var e=__values(n),r=e.next();!r.done;r=e.next()){var s=r.value,a=this.hashTable.get(s);a&&(a.delete(t),0===a.size&&(this.returnSetToPool(a),this.hashTable.delete(s)))}}catch(t){o={error:t}}finally{try{r&&!r.done&&(i=e.return)&&i.call(e)}finally{if(o)throw o.error}}this.objectTable.delete(t)}},t.prototype.clear=function(){var t,o;try{for(var i=__values(this.setPool),n=i.next();!n.done;n=i.next()){n.value.clear()}}catch(o){t={error:o}}finally{try{n&&!n.done&&(o=i.return)&&o.call(i)}finally{if(t)throw t.error}}this.hashTable.clear(),this.objectTable.clear()},t}();t.SpatialHash=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.onInitialize=function(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.position=new o.Vector2(t,i)},i}(t.Component);o.Transform=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(o,i){void 0===o&&(o=0),void 0===i&&(i=0),this.x=o instanceof t.FixedPoint?o:new t.FixedPoint(o),this.y=i instanceof t.FixedPoint?i:new t.FixedPoint(i)}return o.zero=function(){return new o},o.prototype.add=function(i){return new o(t.FixedPoint.add(this.x,i.x),t.FixedPoint.add(this.y,i.y))},o.prototype.sub=function(i){return new o(t.FixedPoint.sub(this.x,i.x),t.FixedPoint.sub(this.y,i.y))},o.prototype.mul=function(i){return new o(t.FixedPoint.mul(this.x,i),t.FixedPoint.mul(this.y,i))},o.prototype.div=function(i){return new o(t.FixedPoint.div(this.x,i),t.FixedPoint.div(this.y,i))},o.prototype.set=function(t,o){return this.x=t,this.y=o,this},o.prototype.setR=function(t){return this.x=t.x,this.y=t.y,this},o.prototype.length=function(){var o=t.FixedPoint.add(t.FixedPoint.mul(this.x,this.x),t.FixedPoint.mul(this.y,this.y));return t.FixedPoint.from(Math.sqrt(o.toFloat()))},o.prototype.lengthSquared=function(){return t.FixedPoint.add(t.FixedPoint.mul(this.x,this.x),t.FixedPoint.mul(this.y,this.y))},o.prototype.normalize=function(){var i=this.length();return new o(t.FixedPoint.div(this.x,i),t.FixedPoint.div(this.y,i))},o.prototype.dot=function(o){return t.FixedPoint.add(t.FixedPoint.mul(this.x,o.x),t.FixedPoint.mul(this.y,o.y))},o.prototype.cross=function(o){return t.FixedPoint.sub(t.FixedPoint.mul(this.x,o.y),t.FixedPoint.mul(this.y,o.x))},o.prototype.crossR=function(o){return t.FixedPoint.sub(this.x.mul(o),this.y.mul(o))},o.prototype.distanceTo=function(o){var i=t.FixedPoint.sub(this.x,o.x),n=t.FixedPoint.sub(this.y,o.y),e=t.FixedPoint.add(t.FixedPoint.mul(i,i),t.FixedPoint.mul(n,n));return t.FixedPoint.from(Math.sqrt(e.toFloat()))},o.prototype.perp=function(){return new o(this.y.neg(),this.x)},o.prototype.perpR=function(){return new o(this.y,this.x.neg())},o.prototype.lengthSq=function(){return this.x.mul(this.x).add(this.y.mul(this.y))},o.prototype.negate=function(){return new o(this.x.neg(),this.y.neg())},o.negate=function(t){return t.x=t.x.neg(),t.y=t.y.neg(),t},o}();t.Vector2=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(o,i){void 0===o&&(o=new t.FixedPoint(0,-9.81)),void 0===i&&(i=new t.FixedPoint(1/60)),this.name="PhysicsPlugin",this.gravity=o,this.timeStep=i}return o.prototype.onInit=function(o){o.systemManager.registerSystem(new t.CollisionResponseSystem(o.entityManager,1e3*this.timeStep.toFloat()))},o.prototype.onUpdate=function(t){},o}();t.World=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(o){var i=function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.dependencies=[o.Transform],i}return __extends(i,t),Object.defineProperty(i.prototype,"transform",{get:function(){return null==this._transform&&(this._transform=this.entity.getComponent(o.Transform)),this._transform},enumerable:!0,configurable:!0}),i.prototype.getBounds=function(){return this._bounds.position=this.transform.position,this._bounds},i.prototype.setBounds=function(t){this._bounds=t},i.prototype.intersects=function(t){return this.getBounds().intersects(t.getBounds())},i.prototype.contains=function(t){return this.getBounds().contains(t.getBounds())},i}(t.Component);o.Collider=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(o){function i(){return null!==o&&o.apply(this,arguments)||this}return __extends(i,o),i.prototype.onInitialize=function(o){this.size=o;var i=new t.BoxBounds(this.transform.position,this.size.width,this.size.height,this.entity);this.setBounds(i)},i}(t.Collider);t.BoxCollider=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(o){function i(){return null!==o&&o.apply(this,arguments)||this}return __extends(i,o),i.prototype.onInitialize=function(o){this.radius=o;var i=new t.CircleBounds(this.transform.position,this.radius,this.entity);this.setBounds(i)},i}(t.Collider);t.CircleCollider=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o}(t.Collider);t.PolygonCollider=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(t,o,i,n){this.position=t,this.width=o,this.height=i,this.entity=n}return o.prototype.project=function(o){var i,n,e=[this.position,this.position.add(new t.Vector2(this.width.toFloat(),0)),this.position.add(new t.Vector2(this.width.toFloat(),this.height.toFloat())),this.position.add(new t.Vector2(0,this.height.toFloat()))],r=1/0,s=-1/0;try{for(var a=__values(e),h=a.next();!h.done;h=a.next()){var l=h.value.dot(o).toFloat();r=Math.min(r,l),s=Math.max(s,l)}}catch(t){i={error:t}}finally{try{h&&!h.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return new t.Projection(r,s)},o.prototype.intersects=function(o){var i=new t.IntersectionVisitor(o);return this.accept(i),i.getResult()},o.prototype.contains=function(o){var i=new t.ContainVisitor(o);return this.accept(i),i.getResult()},o.prototype.accept=function(t){t.visitBox(this)},o}();t.BoxBounds=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(t,o,i){this.position=t,this.radius=o,this.entity=i,this.width=o.mul(2),this.height=o.mul(2)}return o.prototype.intersects=function(o){var i=new t.IntersectionVisitor(o);return this.accept(i),i.getResult()},o.prototype.contains=function(o){var i=new t.ContainVisitor(o);return this.accept(i),i.getResult()},o.prototype.accept=function(t){t.visitCircle(this)},o}();t.CircleBounds=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(t){this.other=t,this.result=!1}return o.prototype.visitBox=function(o){if(this.other instanceof t.BoxBounds){var i=this.other;this.result=o.position.x.toFloat()<=i.position.x.toFloat()&&o.position.y.toFloat()<=i.position.y.toFloat()&&o.position.x.toFloat()+o.width.toFloat()>=i.position.x.toFloat()+i.width.toFloat()&&o.position.y.toFloat()+o.height.toFloat()>=i.position.y.toFloat()+i.height.toFloat()}else if(this.other instanceof t.CircleBounds){var n=this.other,e=new t.BoxBounds(n.position,n.radius.mul(2),n.radius.mul(2),n.entity);this.result=o.position.x.toFloat()<=e.position.x.toFloat()&&o.position.y.toFloat()<=e.position.y.toFloat()&&o.position.x.toFloat()+o.width.toFloat()>=e.position.x.toFloat()+e.width.toFloat()&&o.position.y.toFloat()+o.height.toFloat()>=e.position.y.toFloat()+e.height.toFloat()}},o.prototype.visitCircle=function(o){if(this.other instanceof t.CircleBounds){var i=this.other,n=o.position.x.toFloat()-i.position.x.toFloat(),e=o.position.y.toFloat()-i.position.y.toFloat(),r=Math.sqrt(n*n+e*e);this.result=r+i.radius.toFloat()<=o.radius.toFloat()}else if(this.other instanceof t.BoxBounds){var s=this.other,a=Math.sqrt(Math.pow(s.width.toFloat()/2,2)+Math.pow(s.height.toFloat()/2,2)),h=new t.CircleBounds(s.position.add(new t.Vector2(s.width.div(2),s.height.div(2))),new t.FixedPoint(a),s.entity);n=o.position.x.toFloat()-h.position.x.toFloat(),e=o.position.y.toFloat()-h.position.y.toFloat(),r=Math.sqrt(n*n+e*e);this.result=r+h.radius.toFloat()<=o.radius.toFloat()}},o.prototype.visitPolygon=function(o){if(this.other instanceof t.PolygonBounds){var i=this.other;this.result=i.vertices.every(function(t){return o.containsPoint(t)})}},o.prototype.getResult=function(){return this.result},o}();t.ContainVisitor=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(t){this.other=t,this.result=!1}return o.prototype.visitBox=function(o){if(this.other instanceof t.BoxBounds){var i=this.other;this.result=!(o.position.x.add(o.width).lt(i.position.x)||i.position.x.add(i.width).lt(o.position.x)||o.position.y.add(o.height).lt(i.position.y)||i.position.y.add(i.height).lt(o.position.y))}else this.other instanceof t.CircleBounds?this.result=this.intersectsBoxCircle(o,this.other):this.other instanceof t.PolygonBounds&&(this.result=this.intersectsPolygonBox(this.other,o))},o.prototype.visitCircle=function(o){if(this.other instanceof t.CircleBounds){var i=this.other,n=o.position.x.toFloat()-i.position.x.toFloat(),e=o.position.y.toFloat()-i.position.y.toFloat(),r=Math.sqrt(n*n+e*e);this.result=r<o.radius.toFloat()+i.radius.toFloat()}else this.other instanceof t.BoxBounds?this.result=this.intersectsBoxCircle(this.other,o):this.other instanceof t.PolygonBounds&&(this.result=this.intersectsPolygonCircle(this.other,o))},o.prototype.visitPolygon=function(o){if(this.other instanceof t.PolygonBounds){var i=this.other,n=new t.CollisionDetector(o,i);this.result=n.gjk()}else this.other instanceof t.CircleBounds?this.result=this.intersectsPolygonCircle(o,this.other):this.other instanceof t.BoxBounds&&(this.result=this.intersectsPolygonBox(o,this.other))},o.prototype.intersectsBoxCircle=function(t,o){var i=o.position.x.sub(t.position.x.add(t.width.div(2))).abs(),n=o.position.y.sub(t.position.y.add(t.height.div(2))).abs();return!i.gt(t.width.div(2).add(o.radius))&&(!n.gt(t.height.div(2).add(o.radius))&&(!!i.lte(t.width.div(2))||(!!n.lte(t.height.div(2))||i.sub(t.width.div(2)).pow(2).add(n.sub(t.height.div(2)).pow(2)).lte(o.radius.pow(2)))))},o.prototype.intersectsPolygonCircle=function(t,o){var i,n,e=1/0,r=null;try{for(var s=__values(t.vertices),a=s.next();!a.done;a=s.next()){var h=a.value,l=h.sub(o.position).lengthSq().toFloat();l<e&&(e=l,r=h)}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return!!r&&r.sub(o.position).lengthSq().toFloat()<=Math.pow(o.radius.toFloat(),2)},o.prototype.intersectsPolygonBox=function(o,i){for(var n,e,r=[new t.Vector2(1,0),new t.Vector2(0,1),new t.Vector2(-1,0),new t.Vector2(0,-1)],s=0;s<o.vertices.length;s++){var a=o.vertices[s],h=o.vertices[(s+1)%o.vertices.length].sub(a);r.push(h.normalize().perp())}try{for(var l=__values(r),u=l.next();!u.done;u=l.next()){var c=u.value,p=o.project(c),d=i.project(c);if(!p.overlaps(d))return!1}}catch(t){n={error:t}}finally{try{u&&!u.done&&(e=l.return)&&e.call(l)}finally{if(n)throw n.error}}return!0},o.prototype.getResult=function(){return this.result},o}();t.IntersectionVisitor=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var o=function(){function o(){}return Object.defineProperty(o.prototype,"vertices",{get:function(){return this._vertices},enumerable:!0,configurable:!0}),o.prototype.getFarthestPointInDirection=function(t){var o,i,n=-1/0,e=null;try{for(var r=__values(this._vertices),s=r.next();!s.done;s=r.next()){var a=s.value,h=a.dot(t).toFloat();h>n&&(n=h,e=a)}}catch(t){o={error:t}}finally{try{s&&!s.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return e},o.prototype.project=function(o){var i,n,e=1/0,r=-1/0;try{for(var s=__values(this._vertices),a=s.next();!a.done;a=s.next()){var h=a.value.dot(o).toFloat();e=Math.min(e,h),r=Math.max(r,h)}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return new t.Projection(e,r)},o.prototype.containsPoint=function(t){for(var o=!1,i=t.x.toFloat(),n=t.y.toFloat(),e=0,r=this._vertices.length-1;e<this._vertices.length;r=e++){var s=this._vertices[e].x.toFloat(),a=this._vertices[e].y.toFloat(),h=this._vertices[r].x.toFloat(),l=this._vertices[r].y.toFloat();a>n!=l>n&&i<(h-s)*(n-a)/(l-a)+s&&(o=!o)}return o},o.prototype.intersects=function(o){var i=new t.IntersectionVisitor(o);return this.accept(i),i.getResult()},o.prototype.contains=function(o){var i=new t.ContainVisitor(o);return this.accept(i),i.getResult()},o.prototype.accept=function(t){t.visitPolygon(this)},o}();t.PolygonBounds=o}(t.physics||(t.physics={}))}(gs||(gs={}));