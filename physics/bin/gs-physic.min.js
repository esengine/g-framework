window.gs={};var __read=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,s=i.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(r=s.next()).done;)o.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}return o},__spread=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},__values=this&&this.__values||function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}};window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),function(t){var e=function(){function t(t,e,i,r){this.minX=t,this.maxX=e,this.minY=i,this.maxY=r}return t.prototype.union=function(e){return new t(Math.min(this.minX,e.minX),Math.max(this.maxX,e.maxX),Math.min(this.minY,e.minY),Math.max(this.maxY,e.maxY))},t.prototype.area=function(){return(this.maxX-this.minX)*(this.maxY-this.minY)},t.prototype.intersects=function(t){return!(this.minX>t.maxX||this.maxX<t.minX||this.minY>t.maxY||this.maxY<t.minY)},t.prototype.computeCollisionTime=function(t){var e,i,r,n,s=t.velocityX-this.velocityX,o=t.velocityY-this.velocityY;s>0?(e=(this.minX-t.maxX)/s,r=(this.maxX-t.minX)/s):(e=(this.maxX-t.minX)/s,r=(this.minX-t.maxX)/s),o>0?(i=(this.minY-t.maxY)/o,n=(this.maxY-t.minY)/o):(i=(this.maxY-t.minY)/o,n=(this.minY-t.maxY)/o);var a=Math.max(e,i),h=Math.min(r,n);return a<h&&a<1&&h>0?a:1/0},t.prototype.clone=function(){var e=new t(this.minX,this.maxX,this.minY,this.maxY);return e.velocityX=this.velocityX,e.velocityY=this.velocityY,e},t}();t.AABB=e}(gs||(gs={})),function(t){var e=function(){function e(e){this.left=null,this.right=null,this.object=e||null,this.bounds=e||new t.AABB(1/0,-1/0,1/0,-1/0)}return e.prototype.insert=function(t){if(!this.left&&!this.right)return this.object=t,this.bounds=t,!1;var e=this.left.bounds.union(t),i=this.right.bounds.union(t);if(e.area()*(this.left.size()+1)-this.bounds.area()*this.size()<i.area()*(this.right.size()+1)-this.bounds.area()*this.size()){var r=this.left.insert(t);return this.bounds=this.bounds.union(t),r}r=this.right.insert(t);return this.bounds=this.bounds.union(t),r},e.prototype.remove=function(t){if(this.object===t)return this.object=null,!0;if(this.left&&this.right){var e=this.left.remove(t)||this.right.remove(t);return e&&this.updateBounds(),e}return!1},e.prototype.updateBounds=function(){this.bounds=this.left.bounds.union(this.right.bounds)},e.prototype.query=function(t){if(!this.bounds.intersects(t))return[];var e=[];return this.object?this.object.intersects(t)&&e.push(this.object):(this.left&&e.push.apply(e,__spread(this.left.query(t))),this.right&&e.push.apply(e,__spread(this.right.query(t)))),e},e.prototype.size=function(){return this.left||this.right?this.left.size()+this.right.size():1},e.prototype.getObjects=function(){if(this.object)return[this.object];var t=[];return this.left&&t.push.apply(t,__spread(this.left.getObjects())),this.right&&t.push.apply(t,__spread(this.right.getObjects())),t},e}();t.BVHNode=e;var i=function(){function t(){this.root=new e}return t.prototype.insert=function(t){var i,r;if(this.root.insert(t)){var n=this.root.getObjects();this.root=new e;try{for(var s=__values(n),o=s.next();!o.done;o=s.next()){var a=o.value;this.root.insert(a)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}}},t.prototype.query=function(t){return this.root.query(t)},t.prototype.filterPairs=function(t){var e,i,r=[];try{for(var n=__values(t),s=n.next();!s.done;s=n.next()){var o=s.value,a=o[0],h=o[1];-1!=this.query(a).indexOf(h)&&r.push(o)}}catch(t){e={error:t}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return r},t.prototype.remove=function(t){var i,r;if(this.root.remove(t)){var n=this.root.getObjects();this.root=new e;try{for(var s=__values(n),o=s.next();!o.done;o=s.next()){var a=o.value;this.root.insert(a)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}}},t.prototype.update=function(t,e){this.remove(t),t.minX=e.minX,t.minY=e.minY,t.maxX=e.maxX,t.maxY=e.maxY,this.insert(t)},t}();t.BVH=i}(gs||(gs={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(t.Component);t.PhysicsComponent=e}(gs||(gs={})),function(t){var e=function(){function e(e,i,r){void 0===e&&(e=new t.Rectangle(0,0,1e3,1e3)),void 0===i&&(i=4),void 0===r&&(r=10),this.quadtree=new t.QuadTree(e,i,r),this.bvh=new t.BVH,this.entities=new Map}return e.prototype.addObject=function(t,e){this.entities.set(t,e),this.quadtree.insert(e),this.bvh.insert(e)},e.prototype.removeObject=function(t){var e=this.entities.get(t);e&&(this.bvh.remove(e),this.quadtree.remove(e),this.entities.delete(t))},e.prototype.updateObject=function(t,e){var i=this.entities.get(t);i&&(this.bvh.remove(i),this.quadtree.remove(i),i.minX=e.minX,i.minY=e.minY,i.maxX=e.maxX,i.maxY=e.maxY,this.bvh.insert(i),this.quadtree.insert(i))},e.prototype.step=function(e){var i,r,n=this.quadtree.queryPairs();n=t.SweepAndPrune.sweepAndPrune(n),n=this.bvh.filterPairs(n);try{for(var s=__values(n),o=s.next();!o.done;o=s.next()){var a=o.value,h=__read(a,2),u=h[0],l=h[1],c=__read(t.TimeBaseCollisionDetection.handleCollision(u,l),2),y=c[0],f=c[1];this.quadtree.update(u,y),this.bvh.update(u,y),this.quadtree.update(l,f),this.bvh.update(l,f)}}catch(t){i={error:t}}finally{try{o&&!o.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}},e}();t.PhysicsEngine=e}(gs||(gs={})),function(t){var e=function(e){function i(i,r){var n=e.call(this,i,0,t.Matcher.empty().all(t.PhysicsComponent))||this;return n.engine=r,n}return __extends(i,e),i.prototype.update=function(e){var i,r;try{for(var n=__values(e),s=n.next();!s.done;s=n.next())s.value.getComponent(t.PhysicsComponent)}catch(t){i={error:t}}finally{try{s&&!s.done&&(r=n.return)&&r.call(n)}finally{if(i)throw i.error}}var o=t.TimeManager.getInstance().deltaTime;this.engine.step(o)},i}(t.System);t.PhysicsSystem=e}(gs||(gs={})),function(t){var e=function(){return function(t,e){this.x=t,this.y=e}}();t.Point=e}(gs||(gs={})),function(t){var e=function(){function e(e,i,r){this.boundary=e,this.capacity=i,this.cellSize=r,this.nw=null,this.ne=null,this.sw=null,this.se=null,this.aabbs=[],this.spatialHash=new t.SpatialHash(r)}return e.prototype.insert=function(t){return this.boundary.intersectsAABB(t)||this.expandBoundary(t),this.spatialHash.size()<this.capacity?(this.spatialHash.insert(t),this.aabbs.push(t),!0):(null===this.nw&&this.subdivide(),this.nw.insert(t)||this.ne.insert(t)||this.sw.insert(t)||this.se.insert(t))},e.prototype.expandBoundary=function(e){var i,r,n=Math.min(this.boundary.x,e.minX),s=Math.min(this.boundary.y,e.minY),o=Math.max(this.boundary.x+this.boundary.width,e.maxX)-n,a=Math.max(this.boundary.y+this.boundary.height,e.maxY)-s;this.boundary=new t.Rectangle(n,s,o,a),this.spatialHash=new t.SpatialHash(this.cellSize);try{for(var h=__values(this.aabbs),u=h.next();!u.done;u=h.next()){var l=u.value;this.spatialHash.insert(l)}}catch(t){i={error:t}}finally{try{u&&!u.done&&(r=h.return)&&r.call(h)}finally{if(i)throw i.error}}},e.prototype.subdivide=function(){var i,r,n=this.boundary.x,s=this.boundary.y,o=this.boundary.width/2,a=this.boundary.height/2,h=new t.Rectangle(n,s,o,a),u=new t.Rectangle(n+o,s,o,a),l=new t.Rectangle(n,s+a,o,a),c=new t.Rectangle(n+o,s+a,o,a);this.nw=new e(h,this.capacity,this.spatialHash.cellSize),this.ne=new e(u,this.capacity,this.spatialHash.cellSize),this.sw=new e(l,this.capacity,this.spatialHash.cellSize),this.se=new e(c,this.capacity,this.spatialHash.cellSize);var y=this.spatialHash.queryPairs().reduce(function(t,e){return t.concat(e)},[]);try{for(var f=__values(y),v=f.next();!v.done;v=f.next()){var p=v.value;this.nw.insert(p)||this.ne.insert(p)||this.sw.insert(p)||this.se.insert(p)}}catch(t){i={error:t}}finally{try{v&&!v.done&&(r=f.return)&&r.call(f)}finally{if(i)throw i.error}}this.spatialHash.clear()},e.prototype.remove=function(t){return!!this.boundary.intersectsAABB(t)&&(!!this.spatialHash.remove(t)||null!==this.nw&&(this.nw.remove(t)||this.ne.remove(t)||this.sw.remove(t)||this.se.remove(t)))},e.prototype.query=function(t,e){return void 0===e&&(e=[]),this.boundary.intersects(t)?(e.push.apply(e,__spread(this.spatialHash.query(t.x,t.y))),null===this.nw?e:(this.nw.query(t,e),this.ne.query(t,e),this.sw.query(t,e),this.se.query(t,e),e)):e},e.prototype.queryPairs=function(){var t,e,i=[];if(this.nw){var r=this.nw.queryPairs(),n=this.ne.queryPairs(),s=this.sw.queryPairs(),o=this.se.queryPairs();i=i.concat(r,n,s,o)}else{var a=this.spatialHash.queryPairs();try{for(var h=__values(a),u=h.next();!u.done;u=h.next()){var l=u.value;i.push(l)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=h.return)&&e.call(h)}finally{if(t)throw t.error}}}return i},e.prototype.update=function(t,e){return!!this.remove(t)&&(t.minX=e.minX,t.maxX=e.maxX,t.minY=e.minY,t.maxY=e.maxY,this.insert(t))},e}();t.QuadTree=e}(gs||(gs={})),function(t){var e=function(){function t(t,e,i,r){this.x=t,this.y=e,this.width=i,this.height=r}return t.prototype.contains=function(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height},t.prototype.intersects=function(t){return!(t.x>=this.x+this.width||t.x+t.width<=this.x||t.y>=this.y+this.height||t.y+t.height<=this.y)},t.prototype.intersectsAABB=function(t){return this.x<t.maxX&&this.y>t.minX&&this.width<t.maxY&&this.height>t.minY},t}();t.Rectangle=e}(gs||(gs={})),function(t){var e=function(){function t(t){this.cellSize=t,this.buckets=new Map}return t.prototype.size=function(){var t,e,i=0;try{for(var r=__values(this.buckets.values()),n=r.next();!n.done;n=r.next()){i+=n.value.length}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}return i},t.prototype.hash=function(t,e){return Math.floor(t/this.cellSize)+","+Math.floor(e/this.cellSize)},t.prototype.insert=function(t){for(var e=t.minX,i=t.minY,r=t.maxX,n=t.maxY,s=e;s<=r;s+=this.cellSize)for(var o=i;o<=n;o+=this.cellSize){var a=this.hash(s,o);this.buckets.has(a)||this.buckets.set(a,[]),this.buckets.get(a).push(t)}},t.prototype.remove=function(t){for(var e=t.minX,i=t.minY,r=t.maxX,n=t.maxY,s=e;s<=r;s+=this.cellSize)for(var o=i;o<=n;o+=this.cellSize){var a=this.hash(s,o),h=this.buckets.get(a);if(h){var u=h.indexOf(t);if(-1!==u)return h.splice(u,1),0===h.length&&this.buckets.delete(a),!0}}return!1},t.prototype.query=function(t,e){var i=this.hash(t,e);return this.buckets.get(i)||[]},t.prototype.queryPairs=function(){var t=[];return this.buckets.forEach(function(e,i){for(var r=0;r<e.length;r++)for(var n=r+1;n<e.length;n++)t.push([e[r],e[n]])}),t},t.prototype.clear=function(){this.buckets.clear()},t}();t.SpatialHash=e}(gs||(gs={})),function(t){var e=function(){function t(){}return t.sweepAndPrune=function(t){var e,i,r,n,s=[];try{for(var o=__values(t),a=o.next();!a.done;a=o.next()){var h=a.value;s.push(h[0]),s.push(h[1])}}catch(t){e={error:t}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}s.sort(function(t,e){return t.minX-e.minX});var u=[],l=[],c=function(t){var e,i;l=l.filter(function(e){return e.maxX>t.minX});try{for(var r=__values(l),n=r.next();!n.done;n=r.next()){var s=n.value;t.minY<=s.maxY&&t.maxY>=s.minY&&u.push([t,s])}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(e)throw e.error}}l.push(t)};try{for(var y=__values(s),f=y.next();!f.done;f=y.next()){c(f.value)}}catch(t){r={error:t}}finally{try{f&&!f.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}return u},t.mergeSort=function(t,e){if(t.length<=1)return t;var i=Math.floor(t.length/2),r=this.mergeSort(t.slice(0,i),e),n=this.mergeSort(t.slice(i),e);return this.merge(r,n,e)},t.merge=function(t,e,i){for(var r=[],n=0,s=0;n<t.length&&s<e.length;)i(t[n],e[s])<=0?(r.push(t[n]),n++):(r.push(e[s]),s++);return r.concat(t.slice(n)).concat(e.slice(s))},t}();t.SweepAndPrune=e}(gs||(gs={})),function(t){var e=function(){function t(){}return t.handleCollision=function(t,e){var i=t.computeCollisionTime(e),r=t.clone(),n=e.clone();return i<1&&(t.minX+=t.velocityX*i,t.minY+=t.velocityY*i,t.maxX+=t.velocityX*i,t.maxY+=t.velocityY*i,e.minX+=e.velocityX*i,e.minY+=e.velocityY*i,e.maxX+=e.velocityX*i,e.maxY+=e.velocityY*i),[r,n]},t.handleCollisions=function(t){for(var e,i,r=[],n=0;n<t.length;n++)for(var s=n+1;s<t.length;s++)r.push([t[n],t[s]]);for(var o=function(){var t,e,i=1/0,n=null;try{for(var s=__values(r),o=s.next();!o.done;o=s.next()){var a=o.value,h=a[0].computeCollisionTime(a[1]);h<i&&(i=h,n=a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=s.return)&&e.call(s)}finally{if(t)throw t.error}}if(null===n)return"break";var u=__read(n,2),l=u[0],c=u[1];l.minX+=l.velocityX*i,l.minY+=l.velocityY*i,l.maxX+=l.velocityX*i,l.maxY+=l.velocityY*i,c.minX+=c.velocityX*i,c.minY+=c.velocityY*i,c.maxX+=c.velocityX*i,c.maxY+=c.velocityY*i;var y=(l.minX+l.maxX)/2-(c.minX+c.maxX)/2,f=(l.minY+l.maxY)/2-(c.minY+c.maxY)/2,v=Math.sqrt(y*y+f*f);y/=v,f/=v;var p=c.velocityX-l.velocityX,m=c.velocityY-l.velocityY,d=p*y+m*f;if(d>0){var x=2*d*y-p,g=2*d*f-m;l.velocityX-=x,l.velocityY-=g,c.velocityX+=x,c.velocityY+=g}r=r.filter(function(t){return t!==n})};;){if("break"===o())break}try{for(var a=__values(t),h=a.next();!h.done;h=a.next()){var u=h.value;u.minX+=u.velocityX,u.minY+=u.velocityY,u.maxX+=u.velocityX,u.maxY+=u.velocityY}}catch(t){e={error:t}}finally{try{h&&!h.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}},t}();t.TimeBaseCollisionDetection=e}(gs||(gs={}));