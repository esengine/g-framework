window.gs.physics={},window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)i.hasOwnProperty(o)&&(t[o]=i[o])};return function(i,o){function n(){this.constructor=i}t(i,o),i.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}();var gs,__values=this&&this.__values||function(t){var i="function"==typeof Symbol&&t[Symbol.iterator],o=0;return i?i.call(t):{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}}},__read=this&&this.__read||function(t,i){var o="function"==typeof Symbol&&t[Symbol.iterator];if(!o)return t;var n,e,r=o.call(t),s=[];try{for(;(void 0===i||i-- >0)&&!(n=r.next()).done;)s.push(n.value)}catch(t){e={error:t}}finally{try{n&&!n.done&&(o=r.return)&&o.call(r)}finally{if(e)throw e.error}}return s},__spread=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(__read(arguments[i]));return t};!function(t){!function(i){var o=function(t){function o(i,o,n,e){var r=t.call(this,i)||this;return r.entity1=o,r.entity2=n,r.velocities=e,r}return __extends(o,t),o.prototype.reset=function(){t.prototype.reset.call(this),this.entity1=null,this.entity2=null,this.velocities={v1:new i.Vector2(0,0),v2:new i.Vector2(0,0)}},o.prototype.getEntity1=function(){return this.entity1},o.prototype.getEntity2=function(){return this.entity2},o.prototype.getVelocities=function(){return this.velocities},o}(t.Event);i.CollisionEvent=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(){function o(){t.GlobalEventEmitter.on("collision",this.handleCollision.bind(this))}return o.prototype.handleCollision=function(t){var o=t.data,n=o.entity1,e=o.entity2,r=o.velocities;n.getComponent(i.RigidBody).velocity=r.v1,e.getComponent(i.RigidBody).velocity=r.v2},o}();i.CollisionHandlerSystem=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(o){function n(n){var e=o.call(this,n,0,t.Matcher.empty().all(i.RigidBody).one(i.BoxCollider))||this;return e.quadTree=new i.QuadTree(0,{x:new i.FixedPoint(0),y:new i.FixedPoint(0),width:new i.FixedPoint(1e3),height:new i.FixedPoint(1e3)}),e}return __extends(n,o),n.prototype.update=function(o){var n,e,r,s,a,l;try{for(var u=__values(o),h=u.next();!h.done;h=u.next()){var d=(p=h.value).getComponent(i.BoxCollider);d&&this.quadTree.insert(d.getBounds())}}catch(t){n={error:t}}finally{try{h&&!h.done&&(e=u.return)&&e.call(u)}finally{if(n)throw n.error}}try{for(var c=__values(o),y=c.next();!y.done;y=c.next()){var p,f=(p=y.value).getComponent(i.BoxCollider);if(f){var v=f.getBounds(),w=[];this.quadTree.retrieve(w,v);try{for(var g=__values(w),x=g.next();!x.done;x=g.next()){var m=x.value,F=m.entity.getComponent(i.BoxCollider).getBounds();if(this.isColliding(v,F)){var _=this.calculateVelocityAfterCollision(p.getComponent(i.RigidBody),m.entity.getComponent(i.RigidBody));p.getComponent(i.RigidBody).velocity=_.v1,m.entity.getComponent(i.RigidBody).velocity=_.v2;var V=new i.CollisionEvent("collision",p,m.entity,_);t.GlobalEventEmitter.emitEvent(V)}}}catch(t){a={error:t}}finally{try{x&&!x.done&&(l=g.return)&&l.call(g)}finally{if(a)throw a.error}}}}}catch(t){r={error:t}}finally{try{y&&!y.done&&(s=c.return)&&s.call(c)}finally{if(r)throw r.error}}this.quadTree.clear()},n.prototype.calculateVelocityAfterCollision=function(t,i){var o=t.mass.add(i.mass),n=t.mass.sub(i.mass),e=i.mass.sub(t.mass),r=t.mass.mul(2),s=i.mass.mul(2);return{v1:t.velocity.multiplyScalar(n.toFloat()).divideScalar(o.toFloat()).add(i.velocity.multiplyScalar(s.toFloat()).divideScalar(o.toFloat())),v2:t.velocity.multiplyScalar(r.toFloat()).divideScalar(o.toFloat()).subtract(i.velocity.multiplyScalar(e.toFloat()).divideScalar(o.toFloat()))}},n.prototype.isColliding=function(t,i){var o=t.position,n=t.width,e=t.height,r=i.position,s=i.width,a=i.height;return!(r.x.gt(o.x.add(n))||r.x.add(s).lt(o.x)||r.y.gt(o.y.add(e))||r.y.add(a).lt(o.y))},n}(t.System);i.CollisionResponseSystem=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=1e3),this.rawValue=Math.round(t*i),this.precision=i}return t.prototype.add=function(i){return this.rawValue+=i instanceof t?i.rawValue:Math.round(i*this.precision),this},t.prototype.sub=function(i){return this.rawValue-=i instanceof t?i.rawValue:Math.round(i*this.precision),this},t.prototype.mul=function(i){return this.rawValue=i instanceof t?Math.round(this.rawValue*i.rawValue/this.precision):Math.round(this.rawValue*i),this},t.prototype.div=function(i){return this.rawValue=i instanceof t?Math.round(this.rawValue/i.rawValue*this.precision):Math.round(this.rawValue/i*this.precision),this},t.prototype.lt=function(i){return i instanceof t?this.rawValue<i.rawValue:this.rawValue<Math.round(i*this.precision)},t.prototype.gt=function(i){return i instanceof t?this.rawValue>i.rawValue:this.rawValue>Math.round(i*this.precision)},t.prototype.neg=function(){var i=new t;return i.rawValue=-this.rawValue,i},t.prototype.toFloat=function(){return this.rawValue/this.precision},t.add=function(i,o){var n=new t;return n.rawValue=o instanceof t?i.rawValue+o.rawValue:i.rawValue+Math.round(o*i.precision),n},t.subtract=function(i,o){var n=new t;return n.rawValue=o instanceof t?i.rawValue-o.rawValue:i.rawValue-Math.round(o*i.precision),n},t.multiply=function(i,o){var n=new t;return n.rawValue=o instanceof t?Math.round(i.rawValue*o.rawValue/i.precision):Math.round(i.rawValue*o),n},t.divide=function(i,o){var n=new t;return n.rawValue=o instanceof t?Math.round(i.rawValue/o.rawValue*i.precision):Math.round(i.rawValue/o*i.precision),n},t.max=function(t,i){return t.gt(i)?t:i},t.min=function(t,i){return t.lt(i)?t:i},t}();t.FixedPoint=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t,i){this.level=t,this.bounds=i,this.objects=[],this.nodes=[]}return t.prototype.split=function(){var i=this.bounds.width.div(2),o=this.bounds.height.div(2),n=this.bounds.x,e=this.bounds.y;this.nodes[0]=new t(this.level+1,{x:n.add(i),y:e,width:i,height:o}),this.nodes[1]=new t(this.level+1,{x:n,y:e,width:i,height:o}),this.nodes[2]=new t(this.level+1,{x:n,y:e.add(o),width:i,height:o}),this.nodes[3]=new t(this.level+1,{x:n.add(i),y:e.add(o),width:i,height:o})},t.prototype.insert=function(t){if(null!=this.nodes[0]&&-1!=(o=this.getIndex(t)))return void this.nodes[o].insert(t);if(this.objects.push(t),this.objects.length>10&&this.level<5){null==this.nodes[0]&&this.split();for(var i=0;i<this.objects.length;){var o;-1!=(o=this.getIndex(this.objects[i]))?this.nodes[o].insert(this.objects.splice(i,1)[0]):i++}}},t.prototype.getIndex=function(t){var i=-1,o=this.bounds.x.add(this.bounds.width.div(2)),n=this.bounds.y.add(this.bounds.height.div(2)),e=t.y.lt(n)&&t.y.add(t.height).lt(n),r=t.y.gt(n);return t.x.lt(o)&&t.x.add(t.width).lt(o)?e?i=1:r&&(i=2):t.x.gt(o)&&(e?i=0:r&&(i=3)),i},t.prototype.retrieve=function(t,i){var o=this.getIndex(i);return-1!=o&&null!=this.nodes[0]&&this.nodes[o].retrieve(t,i),t.push.apply(t,__spread(this.objects)),t},t.prototype.clear=function(){this.objects=[];for(var t=0;t<this.nodes.length;t++)null!=this.nodes[t]&&(this.nodes[t].clear(),this.nodes[t]=null)},t}();t.QuadTree=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.position=new i.Vector2,o.velocity=new i.Vector2,o.mass=new i.FixedPoint,o.size=new i.Vector2,o}return __extends(o,t),o}(t.Component);i.RigidBody=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){this.width=new t.FixedPoint(i),this.height=new t.FixedPoint(o)}return i.prototype.add=function(t){return new i(this.width.toFloat()+t.width.toFloat(),this.height.toFloat()+t.height.toFloat())},i.prototype.subtract=function(t){return new i(this.width.toFloat()-t.width.toFloat(),this.height.toFloat()-t.height.toFloat())},i.prototype.multiply=function(t){return new i(this.width.toFloat()*t,this.height.toFloat()*t)},i.prototype.divide=function(t){return new i(this.width.toFloat()/t,this.height.toFloat()/t)},i}();t.Size=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.prototype.onInitialize=function(t,o){void 0===t&&(t=0),void 0===o&&(o=0),this.position=new i.Vector2(t,o)},o}(t.Component);i.Transform=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,o){void 0===i&&(i=0),void 0===o&&(o=0),this.x=new t.FixedPoint(i),this.y=new t.FixedPoint(o)}return i.prototype.add=function(t){return new i(this.x.toFloat()+t.x.toFloat(),this.y.toFloat()+t.y.toFloat())},i.prototype.subtract=function(t){return new i(this.x.toFloat()-t.x.toFloat(),this.y.toFloat()-t.y.toFloat())},i.prototype.multiply=function(t){return new i(this.x.toFloat()*t,this.y.toFloat()*t)},i.prototype.divide=function(t){return new i(this.x.toFloat()/t,this.y.toFloat()/t)},i.prototype.multiplyScalar=function(t){return new i(this.x.toFloat()*t,this.y.toFloat()*t)},i.prototype.divideScalar=function(t){return new i(this.x.toFloat()/t,this.y.toFloat()/t)},i}();t.Vector2=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(t,i,o){this.gravity=t,this.timeStep=i,this.bodies=[],this.size=o}return i.prototype.addBody=function(t){this.bodies.push(t)},i.prototype.updateSize=function(){var i,o;try{for(var n=__values(this.bodies),e=n.next();!e.done;e=n.next()){var r=e.value;this.size.width=t.FixedPoint.max(this.size.width,t.FixedPoint.add(r.position.x,r.size.x)),this.size.height=t.FixedPoint.max(this.size.height,t.FixedPoint.add(r.position.y,r.size.y))}}catch(t){i={error:t}}finally{try{e&&!e.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}},i.prototype.handleBorderCollision=function(i){(i.position.x.lt(0)||t.FixedPoint.add(i.position.x,i.size.x).gt(this.size.width))&&(i.velocity.x=i.velocity.x.neg()),(i.position.y.lt(0)||t.FixedPoint.add(i.position.y,i.size.y).gt(this.size.height))&&(i.velocity.y=i.velocity.y.neg())},i.prototype.step=function(){var i,o;try{for(var n=__values(this.bodies),e=n.next();!e.done;e=n.next()){var r=e.value;r.velocity.y=t.FixedPoint.add(r.velocity.y,t.FixedPoint.multiply(this.gravity,this.timeStep)),r.position.x=t.FixedPoint.add(r.position.x,t.FixedPoint.multiply(r.velocity.x,this.timeStep)),r.position.y=t.FixedPoint.add(r.position.y,t.FixedPoint.multiply(r.velocity.y,this.timeStep)),this.handleBorderCollision(r)}}catch(t){i={error:t}}finally{try{e&&!e.done&&(o=n.return)&&o.call(n)}finally{if(i)throw i.error}}this.updateSize()},i}();t.World=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var o=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i}(t.Component);i.Collider=o}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(i){function o(){return null!==i&&i.apply(this,arguments)||this}return __extends(o,i),o.prototype.onInitialize=function(i){this.size=i,this.transform=this.entity.getComponent(t.Transform)},o.prototype.getBounds=function(){return{position:this.transform.position,width:this.size.width,height:this.size.height}},o}(t.Collider);t.BoxCollider=i}(t.physics||(t.physics={}))}(gs||(gs={}));