window.gs.physics={};var gs,__read=this&&this.__read||function(t,i){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var e,s,r=n.call(t),o=[];try{for(;(void 0===i||i-- >0)&&!(e=r.next()).done;)o.push(e.value)}catch(t){s={error:t}}finally{try{e&&!e.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o},__spread=this&&this.__spread||function(){for(var t=[],i=0;i<arguments.length;i++)t=t.concat(__read(arguments[i]));return t},__values=this&&this.__values||function(t){var i="function"==typeof Symbol&&t[Symbol.iterator],n=0;return i?i.call(t):{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}}};window.__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])};return function(i,n){function e(){this.constructor=i}t(i,n),i.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),function(t){!function(t){var i=function(){function i(t,n,e,s){this.velocityX=0,this.velocityY=0,this.colliding=!1,this.id=i.nextId++,this.minX=t,this.maxX=t+e,this.minY=n,this.maxY=n+s}return i.prototype.union=function(t){var n=Math.min(this.minX,t.minX),e=Math.min(this.minY,t.minY);return new i(n,e,Math.max(this.maxX,t.maxX)-n,Math.max(this.maxY,t.maxY)-e)},i.prototype.area=function(){return(this.maxX-this.minX)*(this.maxY-this.minY)},i.prototype.intersects=function(t){return!(this.minX>t.maxX||this.maxX<t.minX||this.minY>t.maxY||this.maxY<t.minY)},i.prototype.getCenter=function(){var i=(this.minX+this.maxX)/2,n=(this.minY+this.maxY)/2;return new t.Point(i,n)},i.prototype.computeCollisionTime=function(t){var i,n,e,s,r=t.velocityX-this.velocityX,o=t.velocityY-this.velocityY;r>0?(i=(this.minX-t.maxX)/r,e=(this.maxX-t.minX)/r):(i=(this.maxX-t.minX)/r,e=(this.minX-t.maxX)/r),o>0?(n=(this.minY-t.maxY)/o,s=(this.maxY-t.minY)/o):(n=(this.maxY-t.minY)/o,s=(this.minY-t.maxY)/o);var h=Math.max(i,n),a=Math.min(e,s);return h<a&&h<1&&a>0?h:1/0},i.prototype.clone=function(){var t=this.maxX-this.minX,n=this.maxY-this.minY,e=new i(this.minX,this.minY,t,n);return e.velocityX=this.velocityX,e.velocityY=this.velocityY,e},i.prototype.toString=function(){return"minX:"+this.minX+" maxX:"+this.maxX+" minY:"+this.minY+" maxY"+this.maxY},i.nextId=0,i}();t.AABB=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i){this.left=null,this.right=null,this.object=i||null,this.bounds=i?i.clone():new t.AABB(0,0,-1/0,-1/0)}return i.prototype.insert=function(t){if(!this.left&&!this.right)return this.object=t,this.bounds=t,this.createChildNodes(),!1;var i=this.left.bounds.union(t),n=this.right.bounds.union(t);if(i.area()*(this.left.size()+1)-this.bounds.area()*this.size()<n.area()*(this.right.size()+1)-this.bounds.area()*this.size()){var e=this.left.insert(t);return this.bounds=this.bounds.union(t),e}e=this.right.insert(t);return this.bounds=this.bounds.union(t),e},i.prototype.createChildNodes=function(){var n=this.bounds.getCenter(),e=new t.AABB(this.bounds.minX,this.bounds.minY,n.x-this.bounds.minX,this.bounds.maxY-this.bounds.minY),s=new t.AABB(n.x,this.bounds.minY,this.bounds.maxX-n.x,this.bounds.maxY-this.bounds.minY);this.left=new i(e),this.right=new i(s)},i.prototype.remove=function(t){if(this.object===t)return this.object=null,!0;if(this.left&&this.right){var i=this.left.remove(t)||this.right.remove(t);return i&&this.updateBounds(),i}return!1},i.prototype.updateBounds=function(){this.bounds=this.left.bounds.union(this.right.bounds)},i.prototype.query=function(t){if(!this.bounds.intersects(t))return[];var i=[];return this.object?this.object.intersects(t)&&i.push(this.object):(this.left&&i.push.apply(i,__spread(this.left.query(t))),this.right&&i.push.apply(i,__spread(this.right.query(t)))),i},i.prototype.size=function(){return this.left||this.right?this.left.size()+this.right.size():1},i.prototype.getObjects=function(){if(this.object)return[this.object];var t=[];return this.left&&t.push.apply(t,__spread(this.left.getObjects())),this.right&&t.push.apply(t,__spread(this.right.getObjects())),t},i}();t.BVHNode=i;var n=function(){function t(){this.root=new i}return t.prototype.insert=function(t){var n,e;if(this.root.insert(t)){var s=this.root.getObjects();this.root=new i;try{for(var r=__values(s),o=r.next();!o.done;o=r.next()){var h=o.value;this.root.insert(h)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(n)throw n.error}}}},t.prototype.query=function(t){return this.root.query(t)},t.prototype.filterPairs=function(t){var i,n,e=[];try{for(var s=__values(t),r=s.next();!r.done;r=s.next()){var o=r.value,h=o[0],a=o[1];-1!=this.query(h).indexOf(a)&&e.push(o)}}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return e},t.prototype.remove=function(t){var n,e;if(this.root.remove(t)){var s=this.root.getObjects();this.root=new i;try{for(var r=__values(s),o=r.next();!o.done;o=r.next()){var h=o.value;this.root.insert(h)}}catch(t){n={error:t}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(n)throw n.error}}}},t.prototype.update=function(t,i){this.remove(t),t.minX=i.minX,t.minY=i.minY,t.maxX=i.maxX,t.maxY=i.maxY,this.insert(t)},t}();t.BVH=n}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var n=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.onInitialize=function(t){this.aabb=t},i}(t.Component);i.PhysicsComponent=n}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,n,e){void 0===i&&(i=new t.Rectangle(0,0,1e3,1e3)),void 0===n&&(n=4),void 0===e&&(e=10),this.quadtree=new t.QuadTree(i,n,e),this.entities=new Map}return i.prototype.addObject=function(t,i){this.entities.set(t,i),this.quadtree.insert(i)},i.prototype.getObject=function(t){return this.entities.get(t)},i.prototype.removeObject=function(t){var i=this.entities.get(t);i&&(this.quadtree.remove(i),this.entities.delete(t))},i.prototype.updateObject=function(t,i){var n=this.entities.get(t);n&&(this.quadtree.remove(n),n.minX=i.minX,n.minY=i.minY,n.maxX=i.maxX,n.maxY=i.maxY,this.quadtree.insert(n))},i.prototype.step=function(t){var i,n,e=this.quadtree.queryPairs();try{for(var s=__values(e),r=s.next();!r.done;r=s.next()){var o=r.value,h=__read(o,2),a=h[0],u=h[1];a.colliding=!0,u.colliding=!0}}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}},i}();t.PhysicsEngine=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(i){var n=function(n){function e(e,s,r,o){void 0===s&&(s=new i.Rectangle(0,0,1e3,1e3)),void 0===r&&(r=4),void 0===o&&(o=10);var h=n.call(this,e,0,t.Matcher.empty().all(i.PhysicsComponent))||this;return h.engine=new i.PhysicsEngine(s,r,o),h}return __extends(e,n),e.prototype.onComponentAdded=function(t,n){n instanceof i.PhysicsComponent&&this.engine.addObject(t.getId(),n.aabb)},e.prototype.onComponentRemoved=function(t,i){this.engine.removeObject(t.getId())},e.prototype.update=function(i){var n=t.TimeManager.getInstance().deltaTime;this.engine.step(n)},e}(t.System);i.PhysicsSystem=n}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){return function(t,i){this.x=t,this.y=i}}();t.Point=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function i(i,n,e){this.boundary=i,this.capacity=n,this.cellSize=e,this.nw=null,this.ne=null,this.sw=null,this.se=null,this.aabbs=[],this.spatialHash=new t.SpatialHash(e)}return i.prototype.insert=function(t){return!!this.boundary.containsAABB(t)&&(this.aabbs.length<this.capacity&&null===this.nw?(this.aabbs.push(t),this.spatialHash.insert(t),!0):(null===this.nw&&this.subdivide(),!!(this.nw.insert(t)||this.ne.insert(t)||this.sw.insert(t)||this.se.insert(t))||(this.aabbs.push(t),this.spatialHash.insert(t),!0)))},i.prototype.subdivide=function(){var n,e,s=this.boundary.x,r=this.boundary.y,o=this.boundary.width/2,h=this.boundary.height/2,a=new t.Rectangle(s,r,o,h),u=new t.Rectangle(s+o,r,o,h),c=new t.Rectangle(s,r+h,o,h),l=new t.Rectangle(s+o,r+h,o,h);this.nw=new i(a,this.capacity,this.spatialHash.cellSize),this.ne=new i(u,this.capacity,this.spatialHash.cellSize),this.sw=new i(c,this.capacity,this.spatialHash.cellSize),this.se=new i(l,this.capacity,this.spatialHash.cellSize);try{for(var y=__values(this.aabbs),f=y.next();!f.done;f=y.next()){var p=f.value;this.nw.boundary.containsAABB(p)&&this.nw.insert(p),this.ne.boundary.containsAABB(p)&&this.ne.insert(p),this.sw.boundary.containsAABB(p)&&this.sw.insert(p),this.se.boundary.containsAABB(p)&&this.se.insert(p)}}catch(t){n={error:t}}finally{try{f&&!f.done&&(e=y.return)&&e.call(y)}finally{if(n)throw n.error}}this.aabbs=[],this.spatialHash.clear()},i.prototype.remove=function(t){return!!this.boundary.containsAABB(t)&&(!!this.spatialHash.remove(t)||null!==this.nw&&(this.nw.remove(t)||this.ne.remove(t)||this.sw.remove(t)||this.se.remove(t)))},i.prototype.query=function(t,i){return void 0===i&&(i=[]),this.boundary.intersects(t)?(i.push.apply(i,__spread(this.spatialHash.query(t.x,t.y))),null===this.nw?i:(this.nw.query(t,i),this.ne.query(t,i),this.sw.query(t,i),this.se.query(t,i),i)):i},i.prototype.queryPairs=function(){var t,i,n=[],e=this.spatialHash.queryPairs();try{for(var s=__values(e),r=s.next();!r.done;r=s.next()){var o=r.value;n.push(o)}}catch(i){t={error:i}}finally{try{r&&!r.done&&(i=s.return)&&i.call(s)}finally{if(t)throw t.error}}if(this.nw){var h=this.nw.queryPairs(),a=this.ne.queryPairs(),u=this.sw.queryPairs(),c=this.se.queryPairs();n=n.concat(h,a,u,c)}return n},i.prototype.update=function(t,i){return!!this.remove(t)&&(t.minX=i.minX,t.maxX=i.maxX,t.minY=i.minY,t.maxY=i.maxY,this.insert(t))},i}();t.QuadTree=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t,i,n,e){this.x=t,this.y=i,this.width=n,this.height=e}return t.prototype.contains=function(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height},t.prototype.intersects=function(t){return!(t.x>=this.x+this.width||t.x+t.width<=this.x||t.y>=this.y+this.height||t.y+t.height<=this.y)},t.prototype.containsAABB=function(t){return this.x<=t.minX&&this.x+this.width>=t.maxX&&this.y<=t.minY&&this.y+this.height>=t.maxY},t}();t.Rectangle=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(t){this.cellSize=t,this.buckets=new Map}return t.prototype.size=function(){var t,i,n=0;try{for(var e=__values(this.buckets.values()),s=e.next();!s.done;s=e.next()){n+=s.value.length}}catch(i){t={error:i}}finally{try{s&&!s.done&&(i=e.return)&&i.call(e)}finally{if(t)throw t.error}}return n},t.prototype.hash=function(t,i){return Math.floor(t/this.cellSize)+","+Math.floor(i/this.cellSize)},t.prototype.insert=function(t){for(var i=t.minX,n=t.minY,e=t.maxX,s=t.maxY,r=i;r<=e;r+=this.cellSize)for(var o=n;o<=s;o+=this.cellSize){var h=this.hash(r,o);this.buckets.has(h)||this.buckets.set(h,[]),this.buckets.get(h).push(t)}},t.prototype.remove=function(t){for(var i=t.minX,n=t.minY,e=t.maxX,s=t.maxY,r=!1,o=i;o<=e;o+=this.cellSize)for(var h=n;h<=s;h+=this.cellSize){var a=this.hash(o,h),u=this.buckets.get(a);if(u){var c=u.indexOf(t);-1!==c&&(u.splice(c,1),0===u.length&&this.buckets.delete(a),r=!0)}}return r},t.prototype.query=function(t,i){var n=this.hash(t,i);return this.buckets.get(n)||[]},t.prototype.queryPairs=function(){var t=[],i=new Set;return this.buckets.forEach(function(n,e){for(var s=0;s<n.length;s++)for(var r=s+1;r<n.length;r++){var o=n[s].id<n[r].id?n[s].id+","+n[r].id:n[r].id+","+n[s].id;i.has(o)||(t.push([n[s],n[r]]),i.add(o))}}),t},t.prototype.clear=function(){this.buckets.clear()},t}();t.SpatialHash=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(){}return t.filterPairs=function(t){var i=[];return t.forEach(function(t){i.push(t[0]),i.push(t[1])}),i=__spread(new Set(i)),this.scanSort(i)},t.scanSort=function(t){t.sort(function(t,i){return t.minX-i.minX});for(var i=[],n=0;n<t.length;n++)for(var e=n+1;e<t.length&&!(t[n].maxX<t[e].minX);e++)t[n].intersects(t[e])&&i.push([t[n],t[e]]);return i},t}();t.SweepAndPrune=i}(t.physics||(t.physics={}))}(gs||(gs={})),function(t){!function(t){var i=function(){function t(){}return t.handleCollision=function(t,i){var n=t.computeCollisionTime(i),e=t.clone(),s=i.clone();return n<1&&(t.minX+=t.velocityX*n,t.minY+=t.velocityY*n,t.maxX+=t.velocityX*n,t.maxY+=t.velocityY*n,i.minX+=i.velocityX*n,i.minY+=i.velocityY*n,i.maxX+=i.velocityX*n,i.maxY+=i.velocityY*n),[e,s]},t.handleCollisions=function(t){for(var i,n,e=[],s=0;s<t.length;s++)for(var r=s+1;r<t.length;r++)e.push([t[s],t[r]]);for(var o=function(){var t,i,n=1/0,s=null;try{for(var r=__values(e),o=r.next();!o.done;o=r.next()){var h=o.value,a=h[0].computeCollisionTime(h[1]);a<n&&(n=a,s=h)}}catch(i){t={error:i}}finally{try{o&&!o.done&&(i=r.return)&&i.call(r)}finally{if(t)throw t.error}}if(null===s)return"break";var u=__read(s,2),c=u[0],l=u[1];c.minX+=c.velocityX*n,c.minY+=c.velocityY*n,c.maxX+=c.velocityX*n,c.maxY+=c.velocityY*n,l.minX+=l.velocityX*n,l.minY+=l.velocityY*n,l.maxX+=l.velocityX*n,l.maxY+=l.velocityY*n;var y=(c.minX+c.maxX)/2-(l.minX+l.maxX)/2,f=(c.minY+c.maxY)/2-(l.minY+l.maxY)/2,p=Math.sqrt(y*y+f*f);y/=p,f/=p;var m=l.velocityX-c.velocityX,v=l.velocityY-c.velocityY,d=m*y+v*f;if(d>0){var x=2*d*y-m,b=2*d*f-v;c.velocityX-=x,c.velocityY-=b,l.velocityX+=x,l.velocityY+=b}e=e.filter(function(t){return t!==s})};;){if("break"===o())break}try{for(var h=__values(t),a=h.next();!a.done;a=h.next()){var u=a.value;u.minX+=u.velocityX,u.minY+=u.velocityY,u.maxX+=u.velocityX,u.maxY+=u.velocityY}}catch(t){i={error:t}}finally{try{a&&!a.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}},t}();t.TimeBaseCollisionDetection=i}(t.physics||(t.physics={}))}(gs||(gs={}));